import{d as K,q as F,r as u,f as G,g as H,c,a as t,m as p,w as g,v as R,h as T,b as Q,F as U,i as $,x as W,l as J,C as X,t as a,p as k,y as Y,G as Z,e as ee,o as d}from"./index-o0ffgrYm.js";import{u as te}from"./showcase-DDlJsfvZ.js";import{u as se}from"./usePoints-CTAEdpGp.js";import{showcaseApi as N}from"./showcase-RZ3q1SNX.js";const oe={class:"container mx-auto px-4 py-8"},re={class:"card p-4 mb-8"},ae={class:"flex flex-col md:flex-row gap-4 items-center"},ne={class:"flex-1"},le={class:"flex gap-4"},ie={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"},ce=["data-post-id"],de={class:"p-4 border-b",style:{"border-color":"var(--color-border)"}},ue={class:"flex items-center space-x-3"},me={class:"w-10 h-10 rounded-full flex items-center justify-center",style:{background:"var(--color-accent)"}},fe={class:"text-white font-semibold"},ve={class:"font-semibold",style:{color:"var(--color-text-primary)"}},xe={class:"text-sm",style:{color:"var(--color-text-secondary)"}},pe=["data-pet-id"],ye=["src","alt"],he={class:"absolute top-2 right-2"},ge={class:"absolute top-2 left-2"},_e={class:"p-4"},be={class:"font-bold text-lg mb-2"},we={class:"text-gray-600 text-sm mb-4"},ke={class:"flex justify-between items-center"},Ce={class:"flex space-x-4"},Pe=["onClick"],Se={class:"text-sm"},Le=["onClick"],Re={class:"text-sm"},Te=["onClick"],Ue={class:"flex space-x-2"},$e=["onClick"],Ne=["onClick"],Ae={key:0,class:"mt-4 pt-4 border-t"},De={key:0,class:"space-y-3 mb-4"},Ve={class:"w-6 h-6 bg-gray-400 rounded-full flex items-center justify-center"},Ie={class:"text-white text-xs"},Me={class:"flex-1"},Be={class:"bg-gray-100 rounded-lg px-3 py-2"},Ee={class:"text-sm font-semibold"},qe={class:"text-sm"},Oe={class:"text-xs text-gray-500 mt-1"},je={class:"flex space-x-2"},ze=["onUpdate:modelValue","onKeyup"],Ke=["onClick"],Fe={key:0,class:"text-center py-16"},Xe=K({__name:"PlazaView",setup(Ge){const i=F(),A=te(),{awardPoints:_,spendPoints:D}=se(),m=u(""),f=u(""),y=u("newest"),b=u([]),C=u(!0),V=u(1),I=u(1),w=u({}),h=s=>(w.value[s]||(w.value[s]={showComments:!1,newComment:""}),w.value[s]),P=G(()=>{let s=b.value;if(f.value&&(s=s.filter(r=>r.userPet.pet.rarity===f.value)),m.value){const r=m.value.toLowerCase();s=s.filter(e=>e.userPet.pet.name.toLowerCase().includes(r)||e.content.toLowerCase().includes(r)||e.author.username.toLowerCase().includes(r))}return[...s].sort((r,e)=>{var l,v;switch(y.value){case"newest":return new Date(e.createdAt).getTime()-new Date(r.createdAt).getTime();case"popular":return(((l=e._count)==null?void 0:l.likes)||0)-(((v=r._count)==null?void 0:v.likes)||0);case"rarity":const x={UR:5,SSR:4,SR:3,R:2,N:1};return(x[e.userPet.pet.rarity]||1)-(x[r.userPet.pet.rarity]||1);default:return 0}})}),M=s=>{const o={N:"rarity-badge-n",R:"rarity-badge-r",SR:"rarity-badge-sr",SSR:"rarity-badge-ssr",UR:"rarity-badge-ur"};return o[s]||o.N},S=s=>{const o=new Date(s),e=Math.floor((new Date().getTime()-o.getTime())/(1e3*60*60));return e<1?"åˆšåˆš":e<24?`${e}å°æ—¶å‰`:`${Math.floor(e/24)}å¤©å‰`},B=async s=>{var o,r;if(!i.isAuthenticated){alert("è¯·å…ˆç™»å½•");return}try{const e=await N.toggleLike(s.id);if(s.isLiked=e.isLiked,s._count.likes=e.likesCount,e.isLiked){await _("LIKE_POST");const l=document.querySelector(`[data-post-id="${s.id}"] .like-button`);l&&(l.classList.add("liked"),setTimeout(()=>{l.classList.remove("liked"),l.classList.add("liked")},300))}}catch(e){console.error("ç‚¹èµæ“ä½œå¤±è´¥:",e),alert(((r=(o=e.response)==null?void 0:o.data)==null?void 0:r.message)||"æ“ä½œå¤±è´¥")}},E=s=>{const o=h(s.id);o.showComments=!o.showComments},L=async s=>{var o,r;s.newComment.trim()&&(A.addComment(s.id,s.newComment.trim(),{id:((o=i.user)==null?void 0:o.id)||"anonymous",username:((r=i.user)==null?void 0:r.username)||"åŒ¿åç”¨æˆ·"}),s.newComment="",await _("COMMENT"),console.log("æ·»åŠ è¯„è®º:",s.id))},q=async s=>{var r;if(((r=i.user)==null?void 0:r.id)===s.author.id){alert("ä¸èƒ½ä¸è‡ªå·±çš„å® ç‰©äº’åŠ¨å“¦ï¼");return}if(await _("PET_INTERACTION")){const e=document.querySelector(`[data-pet-id="${s.id}"]`);e&&(e.classList.add("pet-bounce"),setTimeout(()=>{e.classList.remove("pet-bounce")},600)),alert("ä½ è½»è½»æ‹äº†æ‹è¿™åªå¯çˆ±çš„å® ç‰©ï¼è·å¾—äº†2ç§¯åˆ†ï¼")}else alert("ä»Šæ—¥äº’åŠ¨æ¬¡æ•°å·²è¾¾ä¸Šé™ï¼");console.log("ä¸å® ç‰©äº’åŠ¨:",s.userPet.pet.name)},O=async s=>{if(!i.user){alert("è¯·å…ˆç™»å½•ï¼");return}if(i.user.id===s.author.id){alert("ä¸èƒ½è´­ä¹°è‡ªå·±çš„å® ç‰©ï¼");return}const o=s.userPet.price||500;confirm(`ç¡®å®šè¦èŠ±è´¹ ${o} ç§¯åˆ†è´­ä¹°è¿™åª ${s.userPet.pet.name} å—ï¼Ÿ`)&&(await D(o,`è´­ä¹°å® ç‰©: ${s.userPet.pet.name}`)?(alert(`è´­ä¹°æˆåŠŸï¼${s.userPet.pet.name} ç°åœ¨æ˜¯ä½ çš„äº†ï¼`),console.log("è´­ä¹°å® ç‰©:",s.userPet)):alert("ç§¯åˆ†ä¸è¶³ï¼"))},j=s=>{if(!i.user){alert("è¯·å…ˆç™»å½•ï¼");return}if(i.user.id===s.author.id){alert("ä¸èƒ½ä¸è‡ªå·±äº¤æ˜“ï¼");return}const o=prompt(`æƒ³è¦ä¸ ${s.author.username} äº¤æ˜“ä»€ä¹ˆï¼Ÿè¯·è¾“å…¥ä½ æƒ³è¦äº¤æ¢çš„å® ç‰©åç§°æˆ–ç§¯åˆ†æ•°é‡ï¼š`);o&&(alert(`äº¤æ˜“è¯·æ±‚å·²å‘é€ç»™ ${s.author.username}ï¼`),console.log("å‘èµ·äº¤æ˜“:",{from:i.user.username,to:s.author.username,targetPet:s.userPet.pet.name,offer:o}))},z=async()=>{try{C.value=!0;const s=await N.getPosts({page:V.value,sortBy:y.value,rarity:f.value||void 0,search:m.value||void 0});b.value=s.posts,I.value=s.totalPages}catch(s){console.error("åŠ è½½å¹¿åœºå¸–å­å¤±è´¥:",s),b.value=[]}finally{C.value=!1}};return H(()=>{z()}),(s,o)=>{const r=X("RouterLink");return d(),c("div",oe,[o[11]||(o[11]=t("div",{class:"text-center mb-8"},[t("h1",{class:"mb-4",style:{"font-family":"var(--font-heading)","font-size":"var(--text-4xl)",color:"var(--color-text-primary)","font-weight":"900"}}," ğŸ›ï¸ å® ç‰©å¹¿åœº "),t("p",{style:{"font-size":"var(--text-lg)",color:"var(--color-text-secondary)","font-family":"var(--font-body)"}}," åˆ†äº«ä½ çš„å® ç‰©ï¼Œå‘ç°æ›´å¤šæƒŠå–œ ")],-1)),t("div",re,[t("div",ae,[t("div",ne,[g(t("input",{"onUpdate:modelValue":o[0]||(o[0]=e=>m.value=e),type:"text",placeholder:"æœç´¢å® ç‰©æˆ–ç”¨æˆ·...",class:"input w-full"},null,512),[[R,m.value]])]),t("div",le,[g(t("select",{"onUpdate:modelValue":o[1]||(o[1]=e=>f.value=e),class:"input"},o[3]||(o[3]=[Q('<option value="">å…¨éƒ¨ç¨€æœ‰åº¦</option><option value="N">æ™®é€š (N)</option><option value="R">ç¨€æœ‰ (R)</option><option value="SR">å²è¯— (SR)</option><option value="SSR">ä¼ è¯´ (SSR)</option><option value="UR">ç¥è¯ (UR)</option>',6)]),512),[[T,f.value]]),g(t("select",{"onUpdate:modelValue":o[2]||(o[2]=e=>y.value=e),class:"input"},o[4]||(o[4]=[t("option",{value:"newest"},"æœ€æ–°å‘å¸ƒ",-1),t("option",{value:"popular"},"æœ€å—æ¬¢è¿",-1),t("option",{value:"rarity"},"æŒ‰ç¨€æœ‰åº¦",-1)]),512),[[T,y.value]])])])]),t("div",ie,[(d(!0),c(U,null,$(P.value,e=>{var l,v,x;return d(),c("div",{key:e.id,"data-post-id":e.id,class:"card overflow-hidden card-stagger-in"},[t("div",de,[t("div",ue,[t("div",me,[t("span",fe,a(e.author.username[0].toUpperCase()),1)]),t("div",null,[t("h3",ve,a(e.author.username),1),t("p",xe,a(S(e.createdAt)),1)])])]),t("div",{class:"aspect-square relative","data-pet-id":e.id},[t("img",{src:e.userPet.status==="ADULT"?e.userPet.pet.adultImageUrl:e.userPet.pet.babyImageUrl,alt:e.userPet.nickname||e.userPet.pet.name,class:"w-full h-full object-cover transition-transform duration-300"},null,8,ye),t("div",he,[t("span",{class:k(["rarity-badge",M(e.userPet.pet.rarity)])},a(e.userPet.pet.rarity),3)]),t("div",ge,[t("span",{class:k([e.userPet.status==="ADULT"?"bg-green-500":"bg-blue-500","px-2 py-1 rounded text-xs font-bold text-white"])},a(e.userPet.status==="ADULT"?"æˆä½“":"å¹¼ä½“"),3)])],8,pe),t("div",_e,[t("h4",be,a(e.userPet.nickname||e.userPet.pet.name),1),t("p",we,a(e.content||e.userPet.pet.story),1),t("div",ke,[t("div",Ce,[t("button",{onClick:n=>B(e),class:k(["like-button flex items-center space-x-1 hover:text-red-500 transition-colors",e.isLiked?"liked text-red-500":"text-gray-500"])},[t("span",null,a(e.isLiked?"â¤ï¸":"ğŸ¤"),1),t("span",Se,a(((l=e._count)==null?void 0:l.likes)||0),1)],10,Pe),t("button",{onClick:n=>E(e),class:"flex items-center space-x-1 text-gray-500 hover:text-blue-500 transition-colors"},[o[5]||(o[5]=t("span",null,"ğŸ’¬",-1)),t("span",Re,a(((v=e._count)==null?void 0:v.comments)||0),1)],8,Le),t("button",{onClick:n=>q(e),class:"flex items-center space-x-1 text-gray-500 hover:text-yellow-500 transition-colors"},o[6]||(o[6]=[t("span",null,"ğŸ¾",-1),t("span",{class:"text-sm"},"æ‹æ‹",-1)]),8,Te)]),t("div",Ue,[e.userPet.forSale?(d(),c("button",{key:0,onClick:n=>O(e),class:"px-3 py-1 bg-green-500 text-white text-xs rounded hover:bg-green-600 transition-colors"}," ğŸ’° "+a(e.userPet.price)+"ç§¯åˆ† ",9,$e)):p("",!0),((x=Y(i).user)==null?void 0:x.id)!==e.author.id?(d(),c("button",{key:1,onClick:n=>j(e),class:"px-3 py-1 bg-blue-500 text-white text-xs rounded hover:bg-blue-600 transition-colors"}," ğŸ”„ äº¤æ˜“ ",8,Ne)):p("",!0)])]),h(e.id).showComments?(d(),c("div",Ae,[e.comments&&e.comments.length>0?(d(),c("div",De,[(d(!0),c(U,null,$(e.comments,n=>(d(),c("div",{key:n.id,class:"flex space-x-2"},[t("div",Ve,[t("span",Ie,a(n.author.username[0].toUpperCase()),1)]),t("div",Me,[t("div",Be,[t("p",Ee,a(n.author.username),1),t("p",qe,a(n.content),1)]),t("p",Oe,a(S(n.createdAt)),1)])]))),128))])):p("",!0),t("div",je,[g(t("input",{"onUpdate:modelValue":n=>h(e.id).newComment=n,type:"text",placeholder:"å†™ä¸ªè¯„è®º...",class:"flex-1 px-3 py-2 border rounded-lg text-sm",onKeyup:Z(n=>L(e),["enter"])},null,40,ze),[[R,h(e.id).newComment]]),t("button",{onClick:n=>L(e),class:"bg-blue-500 text-white px-3 py-2 rounded-lg text-sm hover:bg-blue-600"}," å‘é€ ",8,Ke)])])):p("",!0)])],8,ce)}),128))]),P.value.length===0?(d(),c("div",Fe,[o[8]||(o[8]=t("div",{class:"text-6xl mb-4"},"ğŸ›ï¸",-1)),o[9]||(o[9]=t("h3",{class:"text-xl font-semibold mb-2"},"æš‚æ— åˆ†äº«",-1)),o[10]||(o[10]=t("p",{class:"text-gray-600 mb-4"},"è¿˜æ²¡æœ‰äººåˆ†äº«å® ç‰©ï¼Œå¿«å»æˆ‘çš„å® ç‰©é¡µé¢åˆ†äº«ä½ çš„ç¬¬ä¸€åªå® ç‰©å§ï¼",-1)),W(r,{to:"/my-pets",class:"bg-blue-500 text-white px-6 py-2 rounded-lg hover:bg-blue-600 transition-colors"},{default:J(()=>o[7]||(o[7]=[ee(" æˆ‘çš„å® ç‰© ",-1)])),_:1,__:[7]})])):p("",!0)])}}});export{Xe as default};
