const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/showcase-RZ3q1SNX.js","assets/index-o0ffgrYm.js","assets/index-CTc8BNRK.css","assets/series-DIVEs8_a.js"])))=>i.map(i=>d[i]);
import{J as p,d as Y,q as tt,f as j,r as c,g as et,c as a,a as t,m as f,x as st,t as l,l as ot,C as lt,F as _,i as b,w as x,v,h as rt,E,e as at,p as U,o as n}from"./index-o0ffgrYm.js";const nt={initAdmin:()=>p.post("/admin/init-admin"),getStats:()=>p.get("/admin/stats"),getUserStats:()=>p.get("/admin/stats/users"),getSeriesStats:()=>p.get("/admin/stats/series"),getPetStats:()=>p.get("/admin/stats/pets"),getDrawStats:()=>p.get("/admin/stats/draws"),getUsers:()=>p.get("/admin/users"),getSeries:()=>p.get("/admin/series")},it={class:"container mx-auto px-4 py-8"},ct={key:0,class:"text-center py-16"},dt={class:"mb-4"},ut=["disabled"],pt={key:1},xt={class:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8"},yt={class:"card p-6 text-center"},vt={class:"text-2xl font-bold",style:{color:"var(--color-accent)"}},mt={class:"card p-6 text-center"},ft={class:"text-2xl font-bold",style:{color:"var(--color-accent)"}},_t={class:"card p-6 text-center"},bt={class:"text-2xl font-bold",style:{color:"var(--color-accent)"}},ht={class:"card p-6 text-center"},gt={class:"text-2xl font-bold",style:{color:"var(--color-accent)"}},wt={class:"card mb-8"},kt={class:"border-b",style:{"border-color":"var(--color-border)"}},Ct={class:"flex space-x-8 px-6"},At=["onClick"],Dt={class:"p-6"},St={key:0},Ut={class:"flex justify-between items-center mb-6"},Rt={class:"overflow-x-auto"},Nt={class:"min-w-full"},jt={class:"py-3 px-4",style:{color:"var(--color-text-secondary)"}},Et={class:"py-3 px-4"},It={class:"flex items-center space-x-3"},Lt=["src","alt"],Pt={style:{color:"var(--color-text-primary)"}},Vt={class:"py-3 px-4",style:{color:"var(--color-text-secondary)"}},$t={class:"py-3 px-4"},Tt={class:"py-3 px-4",style:{color:"var(--color-text-secondary)"}},zt={class:"py-3 px-4"},Mt={class:"flex space-x-2"},Ft=["onClick"],Ot=["onClick"],Bt={key:1},Zt={class:"flex justify-between items-center mb-6"},qt={class:"flex space-x-2"},Qt={class:"overflow-x-auto"},Ht={class:"min-w-full"},Jt={class:"py-3 px-4",style:{color:"var(--color-text-secondary)"}},Gt={class:"py-3 px-4",style:{color:"var(--color-text-primary)"}},Kt={class:"py-3 px-4",style:{color:"var(--color-text-secondary)"}},Wt={class:"py-3 px-4"},Xt={class:"py-3 px-4",style:{color:"var(--color-text-secondary)"}},Yt={class:"py-3 px-4"},te={class:"flex space-x-2"},ee=["onClick"],se=["onClick"],oe=["onClick"],le={key:2},re={class:"flex justify-between items-center mb-6"},ae={class:"flex space-x-2"},ne={class:"overflow-x-auto"},ie={class:"min-w-full"},ce={class:"py-3 px-4",style:{color:"var(--color-text-secondary)"}},de={class:"py-3 px-4",style:{color:"var(--color-text-primary)"}},ue={class:"py-3 px-4",style:{color:"var(--color-text-secondary)"}},pe={class:"max-w-xs truncate"},xe={class:"py-3 px-4",style:{color:"var(--color-text-secondary)"}},ye={class:"py-3 px-4",style:{color:"var(--color-text-secondary)"}},ve={class:"py-3 px-4",style:{color:"var(--color-text-secondary)"}},me={class:"py-3 px-4"},fe={class:"flex space-x-2"},_e=["onClick"],be=["onClick"],he={key:0,class:"text-center py-8"},ge={key:3},we={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},ke={class:"card p-6"},Ce={class:"space-y-3"},Ae={class:"flex justify-between"},De={class:"font-semibold"},Se={class:"flex justify-between"},Ue={class:"font-semibold"},Re={class:"flex justify-between"},Ne={class:"font-semibold"},je={class:"card p-6"},Ee={class:"space-y-3"},Ie={style:{color:"var(--color-text-secondary)"}},Le={class:"font-semibold"},Pe={key:2,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},Ve={class:"modal-content p-6 max-w-md w-full mx-4"},$e={class:"space-y-4"},Te={class:"flex gap-2 mt-6"},Fe=Y({__name:"AdminView",setup(ze){const h=tt(),I=j(()=>{var o;return((o=h.user)==null?void 0:o.role)==="ADMIN"}),y=c("series"),g=c(!1),w=c(""),k=c(""),C=c(""),$=[{id:"series",name:"系列管理"},{id:"users",name:"用户管理"},{id:"plaza",name:"广场管理"},{id:"analytics",name:"数据统计"}],m=c({totalUsers:0,totalSeries:0,totalPets:0,totalDraws:0}),R=c([]),N=c([]),A=c([]),L=c(!0),D=c(!1),S=c({todayDraws:45,weekDraws:312,monthDraws:1456,rarityDistribution:{N:720,R:432,SR:216,SSR:72,UR:16}}),d=c({name:"",description:"",price:100,image:""}),T=j(()=>{if(!w.value)return N.value;const o=w.value.toLowerCase();return N.value.filter(e=>e.username.toLowerCase().includes(o)||e.id.toLowerCase().includes(o))}),z=o=>({N:"普通",R:"稀有",SR:"史诗",SSR:"传说",UR:"神话"})[o]||"普通",P=o=>new Date(o).toLocaleDateString(),M=o=>{console.log("编辑系列:",o)},F=o=>{o.isActive=!o.isActive,console.log("切换系列状态:",o)},O=()=>{if(!d.value.name||!d.value.description){alert("请填写完整信息");return}const o={id:Date.now(),...d.value,isActive:!0,petCount:0};R.value.push(o),g.value=!1,d.value={name:"",description:"",price:100,image:""}},B=o=>{const e=prompt("请输入要调整的积分数量（正数为增加，负数为减少）:");if(e!==null){const r=parseInt(e);isNaN(r)||(o.points+=r,console.log("调整用户积分:",o,r))}},Z=o=>{confirm(`确定要将 ${o.username} 设为管理员吗？`)&&(o.role="ADMIN",console.log("设置用户为管理员:",o))},q=o=>{const e=o.status==="FROZEN"?"解冻":"冻结";confirm(`确定要${e}用户 ${o.username} 吗？`)&&(o.status=o.status==="FROZEN"?"ACTIVE":"FROZEN",console.log(`${e}用户:`,o))},V=j(()=>{let o=A.value;if(k.value){const e=k.value.toLowerCase();o=o.filter(r=>r.content.toLowerCase().includes(e)||r.author.username.toLowerCase().includes(e))}return C.value&&(o=o.filter(e=>e.status===C.value)),o}),Q=o=>{console.log("查看帖子:",o)},H=async o=>{var e,r;if(confirm(`确定要删除这条帖子吗？
内容: ${o.content.slice(0,50)}...`))try{const{showcaseApi:s}=await E(async()=>{const{showcaseApi:u}=await import("./showcase-RZ3q1SNX.js");return{showcaseApi:u}},__vite__mapDeps([0,1,2]));await s.deletePost(o.id);const i=A.value.findIndex(u=>u.id===o.id);i>-1&&A.value.splice(i,1),alert("帖子已删除")}catch(s){console.error("删除帖子失败:",s),alert(((r=(e=s.response)==null?void 0:e.data)==null?void 0:r.message)||"删除失败")}},J=async()=>{var o,e;try{D.value=!0,await nt.initAdmin(),await h.refreshUser(),alert("管理员权限设置成功！页面将刷新。"),window.location.reload()}catch(r){console.error("初始化管理员失败:",r),alert(((e=(o=r.response)==null?void 0:o.data)==null?void 0:e.message)||"初始化失败")}finally{D.value=!1}},G=async()=>{try{const o={Authorization:`Bearer ${h.accessToken}`,"Content-Type":"application/json"},[e,r,s,i]=await Promise.all([fetch("/api/admin/stats/users",{headers:o}).then(u=>u.json()),fetch("/api/admin/stats/series",{headers:o}).then(u=>u.json()),fetch("/api/admin/stats/pets",{headers:o}).then(u=>u.json()),fetch("/api/admin/stats/draws",{headers:o}).then(u=>u.json())]);m.value={totalUsers:e.count||0,totalSeries:r.count||0,totalPets:s.count||0,totalDraws:i.count||0}}catch(o){console.error("加载统计数据失败:",o)}},K=async()=>{try{const{seriesApi:o}=await E(async()=>{const{seriesApi:r}=await import("./series-DIVEs8_a.js");return{seriesApi:r}},__vite__mapDeps([3,1,2])),e=await o.getAll();R.value=e.map(r=>{var s;return{...r,image:r.coverImageUrl,price:r.drawPrice,petCount:((s=r._count)==null?void 0:s.pets)||0}})}catch(o){console.error("加载系列数据失败:",o)}},W=async()=>{try{const o=await fetch("/api/admin/users",{headers:{Authorization:`Bearer ${h.accessToken}`,"Content-Type":"application/json"}});o.ok&&(N.value=await o.json())}catch(o){console.error("加载用户数据失败:",o)}},X=async()=>{try{const{showcaseApi:o}=await E(async()=>{const{showcaseApi:r}=await import("./showcase-RZ3q1SNX.js");return{showcaseApi:r}},__vite__mapDeps([0,1,2])),e=await o.getPosts({limit:100});A.value=e.posts}catch(o){console.error("加载帖子数据失败:",o)}};return et(async()=>{if(I.value)try{L.value=!0,await Promise.all([G(),K(),W(),X()])}catch(o){console.error("加载管理员数据失败:",o)}finally{L.value=!1}}),(o,e)=>{const r=lt("RouterLink");return n(),a("div",it,[e[37]||(e[37]=t("div",{class:"text-center mb-8"},[t("h1",{class:"mb-4",style:{"font-family":"var(--font-heading)","font-size":"var(--text-4xl)",color:"var(--color-text-primary)","font-weight":"900"}}," 🛠️ 管理后台 "),t("p",{style:{"font-size":"var(--text-lg)",color:"var(--color-text-secondary)","font-family":"var(--font-body)"}}," 系统管理和数据统计 ")],-1)),I.value?(n(),a("div",pt,[t("div",xt,[t("div",yt,[e[14]||(e[14]=t("div",{class:"text-3xl mb-2"},"👥",-1)),t("div",vt,l(m.value.totalUsers),1),e[15]||(e[15]=t("div",{class:"text-sm",style:{color:"var(--color-text-secondary)"}},"总用户数",-1))]),t("div",mt,[e[16]||(e[16]=t("div",{class:"text-3xl mb-2"},"📦",-1)),t("div",ft,l(m.value.totalSeries),1),e[17]||(e[17]=t("div",{class:"text-sm",style:{color:"var(--color-text-secondary)"}},"系列数量",-1))]),t("div",_t,[e[18]||(e[18]=t("div",{class:"text-3xl mb-2"},"🐾",-1)),t("div",bt,l(m.value.totalPets),1),e[19]||(e[19]=t("div",{class:"text-sm",style:{color:"var(--color-text-secondary)"}},"宠物种类",-1))]),t("div",ht,[e[20]||(e[20]=t("div",{class:"text-3xl mb-2"},"🎲",-1)),t("div",gt,l(m.value.totalDraws),1),e[21]||(e[21]=t("div",{class:"text-sm",style:{color:"var(--color-text-secondary)"}},"总抽取次数",-1))])]),t("div",wt,[t("div",kt,[t("nav",Ct,[(n(),a(_,null,b($,s=>t("button",{key:s.id,onClick:i=>y.value=s.id,class:U(["py-4 px-2 border-b-2 font-medium text-sm transition-colors",y.value===s.id?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"])},l(s.name),11,At)),64))])]),t("div",Dt,[y.value==="series"?(n(),a("div",St,[t("div",Ut,[e[22]||(e[22]=t("h3",{class:"text-lg font-semibold",style:{color:"var(--color-text-primary)"}},"系列管理",-1)),t("button",{onClick:e[0]||(e[0]=s=>g.value=!0),class:"btn btn-primary"}," ➕ 新增系列 ")]),t("div",Rt,[t("table",Nt,[e[23]||(e[23]=t("thead",null,[t("tr",{class:"border-b",style:{"border-color":"var(--color-border)"}},[t("th",{class:"text-left py-3 px-4 font-medium",style:{color:"var(--color-text-primary)"}},"ID"),t("th",{class:"text-left py-3 px-4 font-medium",style:{color:"var(--color-text-primary)"}},"名称"),t("th",{class:"text-left py-3 px-4 font-medium",style:{color:"var(--color-text-primary)"}},"价格"),t("th",{class:"text-left py-3 px-4 font-medium",style:{color:"var(--color-text-primary)"}},"状态"),t("th",{class:"text-left py-3 px-4 font-medium",style:{color:"var(--color-text-primary)"}},"宠物数"),t("th",{class:"text-left py-3 px-4 font-medium",style:{color:"var(--color-text-primary)"}},"操作")])],-1)),t("tbody",null,[(n(!0),a(_,null,b(R.value,s=>(n(),a("tr",{key:s.id,class:"border-b",style:{"border-color":"var(--color-border)"}},[t("td",jt,l(s.id),1),t("td",Et,[t("div",It,[t("img",{src:s.image,alt:s.name,class:"w-10 h-10 rounded object-cover"},null,8,Lt),t("span",Pt,l(s.name),1)])]),t("td",Vt,l(s.price)+" 积分",1),t("td",$t,[t("span",{class:U(["px-2 py-1 rounded-full text-xs font-medium",s.isActive?"bg-green-100 text-green-800":"bg-red-100 text-red-800"])},l(s.isActive?"启用":"禁用"),3)]),t("td",Tt,l(s.petCount||0),1),t("td",zt,[t("div",Mt,[t("button",{onClick:i=>M(s),class:"text-blue-600 hover:text-blue-800 text-sm"},"编辑",8,Ft),t("button",{onClick:i=>F(s),class:U(["text-sm",s.isActive?"text-red-600 hover:text-red-800":"text-green-600 hover:text-green-800"])},l(s.isActive?"禁用":"启用"),11,Ot)])])]))),128))])])])])):y.value==="users"?(n(),a("div",Bt,[t("div",Zt,[e[24]||(e[24]=t("h3",{class:"text-lg font-semibold",style:{color:"var(--color-text-primary)"}},"用户管理",-1)),t("div",qt,[x(t("input",{"onUpdate:modelValue":e[1]||(e[1]=s=>w.value=s),type:"text",placeholder:"搜索用户...",class:"input"},null,512),[[v,w.value]])])]),t("div",Qt,[t("table",Ht,[e[25]||(e[25]=t("thead",null,[t("tr",{class:"border-b",style:{"border-color":"var(--color-border)"}},[t("th",{class:"text-left py-3 px-4 font-medium",style:{color:"var(--color-text-primary)"}},"ID"),t("th",{class:"text-left py-3 px-4 font-medium",style:{color:"var(--color-text-primary)"}},"用户名"),t("th",{class:"text-left py-3 px-4 font-medium",style:{color:"var(--color-text-primary)"}},"积分"),t("th",{class:"text-left py-3 px-4 font-medium",style:{color:"var(--color-text-primary)"}},"角色"),t("th",{class:"text-left py-3 px-4 font-medium",style:{color:"var(--color-text-primary)"}},"注册时间"),t("th",{class:"text-left py-3 px-4 font-medium",style:{color:"var(--color-text-primary)"}},"操作")])],-1)),t("tbody",null,[(n(!0),a(_,null,b(T.value,s=>(n(),a("tr",{key:s.id,class:"border-b",style:{"border-color":"var(--color-border)"}},[t("td",Jt,l(s.id),1),t("td",Gt,l(s.username),1),t("td",Kt,l(s.points),1),t("td",Wt,[t("span",{class:U(["px-2 py-1 rounded-full text-xs font-medium",s.role==="ADMIN"?"bg-purple-100 text-purple-800":"bg-gray-100 text-gray-800"])},l(s.role==="ADMIN"?"管理员":"用户"),3)]),t("td",Xt,l(P(s.createdAt)),1),t("td",Yt,[t("div",te,[t("button",{onClick:i=>B(s),class:"text-blue-600 hover:text-blue-800 text-sm"},"调整积分",8,ee),s.role!=="ADMIN"?(n(),a("button",{key:0,onClick:i=>Z(s),class:"text-green-600 hover:text-green-800 text-sm"}," 设为管理员 ",8,se)):f("",!0),s.role!=="ADMIN"?(n(),a("button",{key:1,onClick:i=>q(s),class:"text-red-600 hover:text-red-800 text-sm"},l(s.status==="FROZEN"?"解冻":"冻结"),9,oe)):f("",!0)])])]))),128))])])])])):y.value==="plaza"?(n(),a("div",le,[t("div",re,[e[27]||(e[27]=t("h3",{class:"text-lg font-semibold",style:{color:"var(--color-text-primary)"}},"广场管理",-1)),t("div",ae,[x(t("input",{"onUpdate:modelValue":e[2]||(e[2]=s=>k.value=s),type:"text",placeholder:"搜索帖子...",class:"input"},null,512),[[v,k.value]]),x(t("select",{"onUpdate:modelValue":e[3]||(e[3]=s=>C.value=s),class:"input"},e[26]||(e[26]=[t("option",{value:""},"全部状态",-1),t("option",{value:"ACTIVE"},"正常",-1),t("option",{value:"HIDDEN"},"已隐藏",-1),t("option",{value:"DELETED"},"已删除",-1)]),512),[[rt,C.value]])])]),t("div",ne,[t("table",ie,[e[28]||(e[28]=t("thead",null,[t("tr",{class:"border-b",style:{"border-color":"var(--color-border)"}},[t("th",{class:"text-left py-3 px-4 font-medium",style:{color:"var(--color-text-primary)"}},"ID"),t("th",{class:"text-left py-3 px-4 font-medium",style:{color:"var(--color-text-primary)"}},"作者"),t("th",{class:"text-left py-3 px-4 font-medium",style:{color:"var(--color-text-primary)"}},"内容"),t("th",{class:"text-left py-3 px-4 font-medium",style:{color:"var(--color-text-primary)"}},"点赞数"),t("th",{class:"text-left py-3 px-4 font-medium",style:{color:"var(--color-text-primary)"}},"评论数"),t("th",{class:"text-left py-3 px-4 font-medium",style:{color:"var(--color-text-primary)"}},"发布时间"),t("th",{class:"text-left py-3 px-4 font-medium",style:{color:"var(--color-text-primary)"}},"操作")])],-1)),t("tbody",null,[(n(!0),a(_,null,b(V.value,s=>(n(),a("tr",{key:s.id,class:"border-b",style:{"border-color":"var(--color-border)"}},[t("td",ce,l(s.id.slice(0,8))+"...",1),t("td",de,l(s.author.username),1),t("td",ue,[t("div",pe,l(s.content),1)]),t("td",xe,l(s._count.likes),1),t("td",ye,l(s._count.comments),1),t("td",ve,l(P(s.createdAt)),1),t("td",me,[t("div",fe,[t("button",{onClick:i=>Q(s),class:"text-blue-600 hover:text-blue-800 text-sm"},"查看",8,_e),t("button",{onClick:i=>H(s),class:"text-red-600 hover:text-red-800 text-sm"},"删除",8,be)])])]))),128))])])]),V.value.length===0?(n(),a("div",he,e[29]||(e[29]=[t("div",{class:"text-4xl mb-2"},"📝",-1),t("p",{style:{color:"var(--color-text-secondary)"}},"暂无帖子数据",-1)]))):f("",!0)])):y.value==="analytics"?(n(),a("div",ge,[e[35]||(e[35]=t("h3",{class:"text-lg font-semibold mb-6",style:{color:"var(--color-text-primary)"}},"数据统计",-1)),t("div",we,[t("div",ke,[e[33]||(e[33]=t("h4",{class:"font-semibold mb-4",style:{color:"var(--color-text-primary)"}},"抽取统计",-1)),t("div",Ce,[t("div",Ae,[e[30]||(e[30]=t("span",{style:{color:"var(--color-text-secondary)"}},"今日抽取:",-1)),t("span",De,l(S.value.todayDraws),1)]),t("div",Se,[e[31]||(e[31]=t("span",{style:{color:"var(--color-text-secondary)"}},"本周抽取:",-1)),t("span",Ue,l(S.value.weekDraws),1)]),t("div",Re,[e[32]||(e[32]=t("span",{style:{color:"var(--color-text-secondary)"}},"本月抽取:",-1)),t("span",Ne,l(S.value.monthDraws),1)])])]),t("div",je,[e[34]||(e[34]=t("h4",{class:"font-semibold mb-4",style:{color:"var(--color-text-primary)"}},"稀有度分布",-1)),t("div",Ee,[(n(!0),a(_,null,b(S.value.rarityDistribution,(s,i)=>(n(),a("div",{key:i,class:"flex justify-between"},[t("span",Ie,l(z(i))+":",1),t("span",Le,l(s),1)]))),128))])])])])):f("",!0)])])])):(n(),a("div",ct,[e[11]||(e[11]=t("div",{class:"text-6xl mb-4"},"🚫",-1)),e[12]||(e[12]=t("h3",{class:"text-xl font-semibold mb-2"},"访问被拒绝",-1)),e[13]||(e[13]=t("p",{class:"text-gray-600 mb-4"},"您没有管理员权限",-1)),t("div",dt,[t("button",{onClick:J,disabled:D.value,class:"btn btn-secondary mr-4"},l(D.value?"初始化中...":"初始化为管理员"),9,ut),e[9]||(e[9]=t("p",{class:"text-sm text-gray-500 mt-2"}," 如果系统还没有管理员，您可以将自己设置为管理员 ",-1))]),st(r,{to:"/",class:"btn btn-primary"},{default:ot(()=>e[10]||(e[10]=[at(" 返回首页 ",-1)])),_:1,__:[10]})])),g.value?(n(),a("div",Pe,[t("div",Ve,[e[36]||(e[36]=t("h3",{class:"text-lg font-bold mb-4"},"创建新系列",-1)),t("div",$e,[x(t("input",{"onUpdate:modelValue":e[4]||(e[4]=s=>d.value.name=s),type:"text",placeholder:"系列名称",class:"input w-full"},null,512),[[v,d.value.name]]),x(t("textarea",{"onUpdate:modelValue":e[5]||(e[5]=s=>d.value.description=s),placeholder:"系列描述",class:"input w-full h-24 resize-none"},null,512),[[v,d.value.description]]),x(t("input",{"onUpdate:modelValue":e[6]||(e[6]=s=>d.value.price=s),type:"number",placeholder:"抽取价格",class:"input w-full"},null,512),[[v,d.value.price]]),x(t("input",{"onUpdate:modelValue":e[7]||(e[7]=s=>d.value.image=s),type:"url",placeholder:"系列图片URL",class:"input w-full"},null,512),[[v,d.value.image]])]),t("div",Te,[t("button",{onClick:O,class:"flex-1 btn btn-primary"},"创建"),t("button",{onClick:e[8]||(e[8]=s=>g.value=!1),class:"flex-1 btn btn-secondary"},"取消")])])])):f("",!0)])}}});export{Fe as default};
