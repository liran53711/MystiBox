import{d as U,u as I,r as m,f as $,j as L,k as q,l as E,T as H,c as i,m as f,a as e,F as O,i as J,n as K,p as g,t as v,o as a,_ as Q,q as W,s as X,g as Y,x as z,y as w,e as G,z as Z,D as ee,A as se}from"./index-o0ffgrYm.js";import{seriesApi as te}from"./series-DIVEs8_a.js";import{b as ae}from"./boxes-CujsuhC3.js";const oe={key:0,class:"fixed inset-0 z-[9999] flex items-center justify-center",style:{background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)","backdrop-filter":"blur(8px)"}},le={class:"magic-particles"},re={class:"relative w-full h-full flex items-center justify-center"},ie={class:"box-face box-front"},ne={class:"box-decoration"},ce={class:"series-emblem"},de={class:"box-face box-front glowing-face"},ue={class:"box-decoration"},ve={class:"series-emblem glowing"},pe={class:"click-hint"},me={key:2,class:"reveal-container"},be={key:3,class:"result-container"},ge={class:"pet-reveal"},fe=["src","alt"],ye={class:"pet-name"},xe={class:"pet-story"},he=U({__name:"GachaAnimationOverlay",props:{isVisible:{type:Boolean},resultPet:{},rarity:{}},emits:["close","drawAgain","goToCollection"],setup(V,{emit:M}){const p=V,n=M;I();const o=m("falling"),C=m(!1),l=m(!1),y=m(!1),_=$(()=>p.rarity==="SSR"||p.rarity==="UR"),b=$(()=>({N:"light-n",R:"light-r",SR:"light-sr",SSR:"light-ssr",UR:"light-ur"})[p.rarity]||"light-n"),k=$(()=>({SSR:"particles-ssr",UR:"particles-ur"})[p.rarity]||""),R=s=>{const t={N:"rarity-badge-n",R:"rarity-badge-r",SR:"rarity-badge-sr",SSR:"rarity-badge-ssr",UR:"rarity-badge-ur"};return t[s]||t.N},j=async()=>{o.value="falling",C.value=!0,await new Promise(s=>setTimeout(s,1e3)),o.value="glowing"},P=async()=>{o.value="revealing",await new Promise(s=>setTimeout(s,1e3)),o.value="result",setTimeout(()=>{l.value=!0},200),setTimeout(()=>{y.value=!0},800)},B=()=>{n("drawAgain"),n("close")},T=()=>{n("goToCollection"),n("close")},D=s=>{const t=s*18%360,r=200+Math.random()*300,d=Math.cos(t*Math.PI/180)*r,u=Math.sin(t*Math.PI/180)*r,x=Math.random()*2,h=3+Math.random()*2;return{left:`calc(50% + ${d}px)`,top:`calc(50% + ${u}px)`,animationDelay:`${x}s`,animationDuration:`${h}s`}},S=()=>{var r,d,u;if(!((u=(d=(r=p.resultPet)==null?void 0:r.pet)==null?void 0:d.series)!=null&&u.name))return"theme-default";const s=p.resultPet.pet.series.name;return{森林精灵系列:"theme-forest",海洋冒险系列:"theme-ocean",星空守护系列:"theme-star",樱花仙境系列:"theme-sakura",深海奇迹系列:"theme-deep-sea",魔法森林系列:"theme-magic-forest",星空幻想系列:"theme-cosmic"}[s]||"theme-default"},A=()=>{var r,d,u;if(!((u=(d=(r=p.resultPet)==null?void 0:r.pet)==null?void 0:d.series)!=null&&u.name))return"🎁";const s=p.resultPet.pet.series.name;return{森林精灵系列:"🌲",海洋冒险系列:"🌊",星空守护系列:"⭐",樱花仙境系列:"🌸",深海奇迹系列:"🐙",魔法森林系列:"🦄",星空幻想系列:"🌌"}[s]||"🎁"},c=()=>{var s,t,r;return((r=(t=(s=p.resultPet)==null?void 0:s.pet)==null?void 0:t.series)==null?void 0:r.name)||"神秘"};return L(()=>p.isVisible,s=>{s?j():(o.value="falling",C.value=!1,l.value=!1,y.value=!1)}),(s,t)=>(a(),q(H,{name:"gacha-overlay",appear:""},{default:E(()=>{var r,d,u,x,h,N;return[s.isVisible?(a(),i("div",oe,[e("div",le,[(a(),i(O,null,J(20,F=>e("div",{key:F,class:"particle",style:K(D(F))},null,4)),64))]),e("div",re,[o.value==="falling"?(a(),i("div",{key:0,class:g(["gacha-box",{"box-falling":C.value}])},[e("div",{class:g(["box-3d",S()])},[e("div",ie,[e("div",ne,[e("div",ce,v(A()),1),t[0]||(t[0]=e("div",{class:"box-pattern"},null,-1))])]),t[1]||(t[1]=e("div",{class:"box-face box-back"},[e("div",{class:"box-decoration"},[e("div",{class:"box-pattern"})])],-1)),t[2]||(t[2]=e("div",{class:"box-face box-left"},[e("div",{class:"box-decoration"},[e("div",{class:"box-pattern"})])],-1)),t[3]||(t[3]=e("div",{class:"box-face box-right"},[e("div",{class:"box-decoration"},[e("div",{class:"box-pattern"})])],-1)),t[4]||(t[4]=e("div",{class:"box-face box-top"},[e("div",{class:"box-decoration"},[e("div",{class:"ribbon"}),e("div",{class:"bow"})])],-1)),t[5]||(t[5]=e("div",{class:"box-face box-bottom"},null,-1))],2)],2)):f("",!0),o.value==="glowing"?(a(),i("div",{key:1,class:"gacha-box-static",onClick:P},[e("div",{class:g(["box-3d glowing",S()])},[e("div",de,[e("div",ue,[e("div",ve,v(A()),1),t[6]||(t[6]=e("div",{class:"box-pattern glowing"},null,-1)),t[7]||(t[7]=e("div",{class:"energy-pulse"},null,-1))])]),t[8]||(t[8]=e("div",{class:"box-face box-back glowing-face"},[e("div",{class:"box-decoration"},[e("div",{class:"box-pattern glowing"})])],-1)),t[9]||(t[9]=e("div",{class:"box-face box-left glowing-face"},[e("div",{class:"box-decoration"},[e("div",{class:"box-pattern glowing"})])],-1)),t[10]||(t[10]=e("div",{class:"box-face box-right glowing-face"},[e("div",{class:"box-decoration"},[e("div",{class:"box-pattern glowing"})])],-1)),t[11]||(t[11]=e("div",{class:"box-face box-top glowing-face"},[e("div",{class:"box-decoration"},[e("div",{class:"ribbon glowing"}),e("div",{class:"bow glowing"})])],-1)),t[12]||(t[12]=e("div",{class:"box-face box-bottom"},null,-1))],2),e("div",pe,"✨ 点击开启 "+v(c())+" 神秘盲盒 ✨",1)])):f("",!0),o.value==="revealing"?(a(),i("div",me,[e("div",{class:g(["light-beam",b.value])},null,2),_.value?(a(),i("div",{key:0,class:g(["particle-effects",k.value])},null,2)):f("",!0)])):f("",!0),o.value==="result"?(a(),i("div",be,[e("div",ge,[e("img",{src:((r=s.resultPet)==null?void 0:r.pet.babyImageUrl)||"",alt:((d=s.resultPet)==null?void 0:d.pet.name)||"",class:g(["pet-image",{"pet-appear":l.value}])},null,10,fe)]),e("div",{class:g(["result-card",{"card-appear":y.value}])},[e("div",{class:g(["rarity-badge",R((u=s.resultPet)==null?void 0:u.pet.rarity)])},v((x=s.resultPet)==null?void 0:x.pet.rarity),3),e("h3",ye,v((h=s.resultPet)==null?void 0:h.pet.name),1),e("p",xe,v((N=s.resultPet)==null?void 0:N.pet.story),1),e("div",{class:"action-buttons"},[e("button",{onClick:B,class:"btn btn-primary"}," 再抽一次 "),e("button",{onClick:T,class:"btn btn-secondary"}," 放入收藏 ")])],2)])):f("",!0)])])):f("",!0)]}),_:1}))}}),we=Q(he,[["__scopeId","data-v-d81e7289"]]),_e={class:"container mx-auto px-4 py-8"},ke={key:0,class:"text-center py-16"},Ce={key:1,class:"max-w-6xl mx-auto"},$e={class:"grid grid-cols-1 lg:grid-cols-2 gap-8"},Pe={class:"aspect-square rounded-lg overflow-hidden"},Se=["src","alt"],Ae={class:"mb-4",style:{"font-family":"var(--font-heading)","font-size":"var(--text-3xl)",color:"var(--color-text-primary)","font-weight":"900"}},Me={class:"mb-6",style:{color:"var(--color-text-secondary)","font-family":"var(--font-body)","font-size":"var(--text-lg)"}},Re={class:"card p-6 mb-6"},je={class:"space-y-3"},Be={class:"flex justify-between items-center"},Te={class:"font-bold",style:{color:"var(--color-accent)","font-size":"var(--text-lg)"}},De={class:"flex justify-between items-center"},Ne={class:"font-semibold"},ze={key:0,class:"card p-4 mb-6",style:{background:"linear-gradient(135deg, var(--color-secondary), #FFE4B5)"}},Ve={class:"flex items-center justify-between"},Fe={class:"font-bold text-2xl",style:{color:"var(--color-accent)"}},Ge={key:1,class:"mb-4 p-4 rounded-lg",style:{"background-color":"#FEF2F2",border:"1px solid #FECACA"}},Ue={class:"text-sm",style:{color:"var(--color-error)"}},Ie=["disabled"],Ee={key:0,class:"flex items-center justify-center"},Le={key:1,class:"flex items-center justify-center"},qe={key:3,class:"text-center card p-6"},He={key:2,class:"text-center py-16"},Qe=U({__name:"SeriesDetailView",setup(V){const M=X(),p=se(),n=W(),o=I(),C=$(()=>Number(M.params.id)),l=m(null),y=m(!0),_=m(!1),b=m(""),k=m(null),R=$(()=>{var c;return!n.isAuthenticated||!l.value?!1:(((c=n.user)==null?void 0:c.points)||0)>=l.value.price}),j=async()=>{try{y.value=!0,b.value="";const c=await te.getById(C.value);l.value=c}catch(c){console.error("Failed to load series:",c),b.value="加载系列信息失败"}finally{y.value=!1}},P=async()=>{var c,s;if(!(!l.value||!n.isAuthenticated))try{_.value=!0,b.value="";const t=await ae.purchaseBoxes(l.value.id,1);console.log("购买盲盒结果:",t),n.user&&(n.user.points=t.remainingPoints),alert(t.message),p.push("/box-station")}catch(t){console.error("购买盲盒失败:",t),b.value=((s=(c=t.response)==null?void 0:c.data)==null?void 0:s.message)||"购买失败，请重试"}finally{_.value=!1}},B=()=>{k.value=null},T=()=>{k.value=null},D=()=>{o.endGacha()},S=()=>{o.endGacha(),P()},A=()=>{o.endGacha()};return Y(()=>{j()}),(c,s)=>{var t,r,d,u,x,h;return a(),i("div",_e,[y.value?(a(),i("div",ke,s[1]||(s[1]=[e("div",{class:"inline-block animate-spin rounded-full h-8 w-8 border-b-2",style:{"border-color":"var(--color-accent)"}},null,-1),e("p",{class:"mt-2",style:{color:"var(--color-text-secondary)"}},"加载中...",-1)]))):l.value?(a(),i("div",Ce,[e("button",{onClick:s[0]||(s[0]=N=>c.$router.push("/store")),class:"mb-6 flex items-center space-x-2 text-blue-600 hover:text-blue-800 transition-colors"},s[2]||(s[2]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1),e("span",null,"返回商店",-1)])),e("div",$e,[e("div",Pe,[e("img",{src:l.value.image,alt:l.value.name,class:"w-full h-full object-cover"},null,8,Se)]),e("div",null,[e("h1",Ae,v(l.value.name),1),e("p",Me,v(l.value.description),1),e("div",Re,[s[6]||(s[6]=e("h3",{class:"mb-4",style:{"font-family":"var(--font-heading)","font-size":"var(--text-xl)",color:"var(--color-text-primary)","font-weight":"700"}}," 💎 系列信息 ",-1)),e("div",je,[e("div",Be,[s[3]||(s[3]=e("span",{style:{color:"var(--color-text-secondary)"}},"抽取价格:",-1)),e("span",Te," 💰 "+v(l.value.drawPrice)+" 积分 ",1)]),e("div",De,[s[4]||(s[4]=e("span",{style:{color:"var(--color-text-secondary)"}},"宠物数量:",-1)),e("span",Ne,"🐾 "+v(((t=l.value.pets)==null?void 0:t.length)||0)+" 只",1)]),s[5]||(s[5]=e("div",{class:"flex justify-between items-center"},[e("span",{style:{color:"var(--color-text-secondary)"}},"稀有度范围:"),e("span",{class:"font-semibold"},"⭐ N ~ UR")],-1))])]),w(n).isAuthenticated?(a(),i("div",ze,[e("div",Ve,[s[7]||(s[7]=e("span",{style:{color:"var(--color-text-primary)","font-weight":"600"}},"💰 我的积分:",-1)),e("span",Fe,v(((r=w(n).user)==null?void 0:r.points)||0),1)])])):f("",!0),b.value?(a(),i("div",Ge,[e("p",Ue,v(b.value),1)])):f("",!0),w(n).isAuthenticated?(a(),i("button",{key:2,disabled:!R.value||_.value,class:"w-full btn btn-primary mb-4",style:{"font-size":"var(--text-xl)",padding:"20px","font-weight":"700"},onClick:P},[_.value?(a(),i("span",Ee,s[8]||(s[8]=[e("svg",{class:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),G(" 抽取中... ",-1)]))):(a(),i("span",Le," 📦 购买盲盒 ("+v(l.value.drawPrice)+" 积分) ",1))],8,Ie)):(a(),i("div",qe,[s[10]||(s[10]=e("p",{class:"text-neutral-text-secondary mb-4"},"请先登录才能购买盲盒",-1)),z(Z,{variant:"primary",onClick:w(o).openLoginModal},{default:E(()=>s[9]||(s[9]=[G(" 立即登录 ",-1)])),_:1,__:[9]},8,["onClick"])]))])]),z(ee,{show:!!k.value,result:k.value,onClose:B,onContinue:T},null,8,["show","result"])])):(a(),i("div",He,s[11]||(s[11]=[e("p",{class:"text-neutral-text-secondary"},"系列不存在",-1)]))),z(we,{"is-visible":w(o).isGachaPlaying,"result-pet":(d=w(o).gachaResult)==null?void 0:d[0],rarity:(h=(x=(u=w(o).gachaResult)==null?void 0:u[0])==null?void 0:x.pet)==null?void 0:h.rarity,onClose:D,onDrawAgain:S,onGoToCollection:A},null,8,["is-visible","result-pet","rarity"])])}}});export{Qe as default};
