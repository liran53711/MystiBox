const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/users-BOqreVSi.js","assets/index-o0ffgrYm.js","assets/index-CTc8BNRK.css"])))=>i.map(i=>d[i]);
import{d as Q,r as c,j as le,g as X,c as a,a as e,m as g,t as r,p as m,F as w,i as k,w as B,v as N,G as ie,K as T,o as n,_ as re,q as ce,u as de,k as ue,y as q,E as R}from"./index-o0ffgrYm.js";import{u as pe}from"./usePoints-CTAEdpGp.js";const ve={class:"fixed bottom-4 right-4 w-80 h-96 bg-white rounded-lg shadow-2xl border flex flex-col z-50"},me={class:"flex items-center justify-between p-4 border-b",style:{background:"var(--color-primary)","border-radius":"8px 8px 0 0"}},fe={class:"flex items-center space-x-3"},ye={class:"w-8 h-8 rounded-full flex items-center justify-center",style:{background:"var(--color-accent)"}},xe={class:"text-white font-bold text-sm"},be={class:"font-semibold text-white"},ge={class:"text-xs text-white opacity-80"},he={key:0,class:"text-center py-8"},_e={key:0,class:"space-y-2"},we={class:"flex items-center space-x-2"},ke={class:"font-medium"},$e={key:0,class:"flex items-center space-x-2 p-2 bg-white bg-opacity-20 rounded"},Ce=["src","alt"],Ie={class:"font-medium"},Se={key:1,class:"flex items-center space-x-2 p-2 bg-white bg-opacity-20 rounded"},Ae=["src","alt"],De={class:"font-medium"},Oe={class:"text-xs opacity-80"},Me={key:2,class:"text-sm italic"},je=["onClick"],Ue={key:4,class:"text-xs opacity-80 text-center py-1"},Re={key:5,class:"text-xs opacity-80 text-center py-1"},Pe={key:1},Te={class:"text-xs opacity-70 mt-1"},Ee={class:"p-4 border-t"},Fe={class:"flex space-x-2 mb-3"},Le={key:0,class:"mb-3 p-2 bg-gray-50 rounded-lg"},Ve={class:"grid grid-cols-8 gap-1"},Ge=["onClick"],Be={class:"flex space-x-2"},Ne=["disabled"],ze={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},He={class:"bg-white rounded-lg p-6 max-w-md w-full mx-4 max-h-96 overflow-y-auto"},We={class:"flex justify-between items-center mb-4"},qe={class:"text-lg font-bold"},Ke={class:"space-y-4"},Ye={class:"flex space-x-4"},Je={key:0,class:"space-y-2 max-h-48 overflow-y-auto"},Qe=["onClick"],Xe={class:"w-12 h-12 rounded-lg overflow-hidden"},Ze=["src","alt"],et={class:"flex-1"},tt={class:"font-medium"},st={class:"flex items-center space-x-2"},ot={class:"text-xs text-gray-500"},nt={key:1,class:"space-y-2 max-h-48 overflow-y-auto"},at=["onClick"],lt={class:"flex items-center space-x-3"},it=["src","alt"],rt={class:"font-medium"},ct={class:"text-sm text-gray-600"},dt={class:"flex space-x-2"},ut=["disabled"],pt=Q({__name:"ChatWindow",props:{friend:{}},emits:["close"],setup(K,{emit:z}){const F=K,{awardPoints:O}=pe(),h=c(""),A=c(),M=c(!1),C=c(!1),v=c("pet"),f=c(null),D=c(""),b=["😊","😂","🥰","😍","🤔","😅","😭","🥺","👍","👎","❤️","💕","🎉","🎊","🔥","⭐"],j=c([{id:"1",nickname:"小可爱",status:"ADULT",pet:{id:"1",name:"小精灵",rarity:"R",babyImageUrl:"https://images.unsplash.com/photo-1578662996442-48f60103fc96?w=300&h=300&fit=crop"}},{id:"2",nickname:null,status:"BABY",pet:{id:"2",name:"海星宝宝",rarity:"N",babyImageUrl:"https://images.unsplash.com/photo-1583212292454-1fe6229603b7?w=300&h=300&fit=crop"}}]),U=c([{id:1,name:"森林精灵系列",price:100,image:"https://images.unsplash.com/photo-1441974231531-c6227db76b6e?w=100&h=100&fit=crop"},{id:2,name:"海洋冒险系列",price:120,image:"https://images.unsplash.com/photo-1559827260-dc66d52bef19?w=100&h=100&fit=crop"}]),x=c([{id:"1",content:"嗨！你好",isOwn:!1,type:"text",createdAt:new Date(Date.now()-10*60*1e3).toISOString()},{id:"2",content:"你好！最近怎么样？",isOwn:!0,type:"text",createdAt:new Date(Date.now()-8*60*1e3).toISOString()},{id:"3",type:"gift",isOwn:!1,gift:{type:"pet",item:{id:"1",nickname:"小可爱",pet:{id:"1",name:"小精灵",rarity:"R",babyImageUrl:"https://images.unsplash.com/photo-1578662996442-48f60103fc96?w=300&h=300&fit=crop"}},message:"送给你一只可爱的小精灵！",claimed:!1},createdAt:new Date(Date.now()-5*60*1e3).toISOString()}]),L=d=>({N:"rarity-badge-n",R:"rarity-badge-r",SR:"rarity-badge-sr",SSR:"rarity-badge-ssr",UR:"rarity-badge-ur"})[d]||"rarity-badge-n",I=d=>{const i=new Date(d),y=Math.floor((new Date().getTime()-i.getTime())/(1e3*60));if(y<1)return"刚刚";if(y<60)return`${y}分钟前`;{const P=Math.floor(y/60);return P<24?`${P}小时前`:i.toLocaleDateString()}},$=async()=>{if(!h.value.trim())return;const d={id:Date.now().toString(),content:h.value.trim(),isOwn:!0,type:"text",createdAt:new Date().toISOString()};x.value.push(d),h.value="",await O("CHAT_MESSAGE"),T(()=>{S()}),setTimeout(()=>{const i=["哈哈，有趣！","我也这么想","真的吗？","太棒了！","😊"],s={id:(Date.now()+1).toString(),content:i[Math.floor(Math.random()*i.length)],isOwn:!1,type:"text",createdAt:new Date().toISOString()};x.value.push(s),T(()=>{S()})},1e3+Math.random()*2e3)},V=d=>{d.gift.claimed=!0,console.log("领取礼物:",d.gift);const i={id:Date.now().toString(),content:"礼物已领取到你的收藏中！",isOwn:!0,type:"text",createdAt:new Date().toISOString()};x.value.push(i),T(()=>{S()})},G=d=>{h.value+=d,C.value=!1},E=()=>{M.value=!1,v.value="pet",f.value=null,D.value=""},H=()=>{if(!f.value)return;const d={id:Date.now().toString(),type:"gift",isOwn:!0,gift:{type:v.value,item:f.value,message:d.value||void 0,claimed:!1},createdAt:new Date().toISOString()};x.value.push(d),console.log("发送礼物:",{to:F.friend.username,type:v.value,item:f.value,message:d.value}),T(()=>{S()}),E(),setTimeout(()=>{const i={id:(Date.now()+1).toString(),content:`收到了你的${v.value==="pet"?"宠物":"盲盒"}！谢谢！🎁`,isOwn:!1,type:"text",createdAt:new Date().toISOString()};x.value.push(i),T(()=>{S()})},2e3)},S=()=>{A.value&&(A.value.scrollTop=A.value.scrollHeight)};return le(()=>x.value.length,()=>{T(()=>{S()})}),X(()=>{S()}),(d,i)=>(n(),a("div",ve,[e("div",me,[e("div",fe,[e("div",ye,[e("span",xe,r(d.friend.username[0].toUpperCase()),1)]),e("div",null,[e("h4",be,r(d.friend.username),1),e("p",ge,[e("span",{class:m(d.friend.isOnline?"text-green-300":"text-gray-300")},r(d.friend.isOnline?"在线":"离线"),3)])])]),e("button",{onClick:i[0]||(i[0]=s=>d.$emit("close")),class:"flex items-center justify-center w-8 h-8 text-white hover:bg-red-500 hover:bg-opacity-80 rounded-full transition-all duration-200 hover:scale-110 focus:outline-none focus:ring-2 focus:ring-white focus:ring-opacity-50",title:"关闭聊天","aria-label":"关闭聊天窗口"},i[7]||(i[7]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","stroke-width":"2.5"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"})],-1)]))]),e("div",{ref_key:"messagesContainer",ref:A,class:"flex-1 overflow-y-auto p-4 space-y-3"},[x.value.length===0?(n(),a("div",he,i[8]||(i[8]=[e("div",{class:"text-4xl mb-2"},"💬",-1),e("p",{class:"text-sm",style:{color:"var(--color-text-secondary)"}},"开始聊天吧！",-1)]))):g("",!0),(n(!0),a(w,null,k(x.value,s=>(n(),a("div",{key:s.id,class:m(["flex",s.isOwn?"justify-end":"justify-start"])},[e("div",{class:m(["max-w-xs px-3 py-2 rounded-lg text-sm",s.isOwn?"bg-blue-500 text-white rounded-br-none":"bg-gray-100 text-gray-800 rounded-bl-none"])},[s.type==="gift"?(n(),a("div",_e,[e("div",we,[i[9]||(i[9]=e("span",{class:"text-lg"},"🎁",-1)),e("span",ke,r(s.isOwn?"你":d.friend.username)+"赠送了一个礼物",1)]),s.gift.type==="pet"?(n(),a("div",$e,[e("img",{src:s.gift.item.pet.babyImageUrl,alt:s.gift.item.pet.name,class:"w-8 h-8 rounded object-cover"},null,8,Ce),e("div",null,[e("p",Ie,r(s.gift.item.nickname||s.gift.item.pet.name),1),e("span",{class:m(["rarity-badge text-xs",L(s.gift.item.pet.rarity)])},r(s.gift.item.pet.rarity),3)])])):s.gift.type==="box"?(n(),a("div",Se,[e("img",{src:s.gift.item.image,alt:s.gift.item.name,class:"w-8 h-8 rounded object-cover"},null,8,Ae),e("div",null,[e("p",De,r(s.gift.item.name),1),e("p",Oe,r(s.gift.item.price)+" 积分",1)])])):g("",!0),s.gift.message?(n(),a("p",Me,' "'+r(s.gift.message)+'" ',1)):g("",!0),!s.isOwn&&!s.gift.claimed?(n(),a("button",{key:3,onClick:y=>V(s),class:"w-full py-2 px-3 bg-white bg-opacity-30 rounded text-sm font-medium hover:bg-opacity-40 transition-colors flex items-center justify-center space-x-1"},i[10]||(i[10]=[e("span",null,"✨",-1),e("span",null,"点击领取",-1)]),8,je)):s.gift.claimed?(n(),a("div",Ue,i[11]||(i[11]=[e("span",{class:"inline-flex items-center space-x-1"},[e("span",null,"✅"),e("span",null,"已领取")],-1)]))):s.isOwn?(n(),a("div",Re,i[12]||(i[12]=[e("span",{class:"inline-flex items-center space-x-1"},[e("span",null,"🎁"),e("span",null,"礼物已发送")],-1)]))):g("",!0)])):(n(),a("div",Pe,[e("p",null,r(s.content),1)])),e("p",Te,r(I(s.createdAt)),1)],2)],2))),128))],512),e("div",Ee,[e("div",Fe,[e("button",{onClick:i[1]||(i[1]=s=>M.value=!0),class:"flex items-center space-x-1 px-3 py-1 bg-pink-100 text-pink-600 rounded-lg text-xs hover:bg-pink-200 transition-colors"},i[13]||(i[13]=[e("span",null,"🎁",-1),e("span",null,"赠送",-1)])),e("button",{onClick:i[2]||(i[2]=s=>C.value=!C.value),class:"flex items-center space-x-1 px-3 py-1 bg-yellow-100 text-yellow-600 rounded-lg text-xs hover:bg-yellow-200 transition-colors"},i[14]||(i[14]=[e("span",null,"😊",-1),e("span",null,"表情",-1)]))]),C.value?(n(),a("div",Le,[e("div",Ve,[(n(),a(w,null,k(b,s=>e("button",{key:s,onClick:y=>G(s),class:"text-lg hover:bg-gray-200 rounded p-1 transition-colors"},r(s),9,Ge)),64))])])):g("",!0),e("div",Be,[B(e("input",{"onUpdate:modelValue":i[3]||(i[3]=s=>h.value=s),onKeypress:ie($,["enter"]),type:"text",placeholder:"输入消息...",class:"flex-1 px-3 py-2 border rounded-lg text-sm focus:outline-none focus:border-blue-500"},null,544),[[N,h.value]]),e("button",{onClick:$,disabled:!h.value.trim(),class:"px-3 py-2 bg-blue-500 text-white rounded-lg text-sm hover:bg-blue-600 transition-colors disabled:bg-gray-300 disabled:cursor-not-allowed"}," 发送 ",8,Ne)])]),M.value?(n(),a("div",ze,[e("div",He,[e("div",We,[e("h3",qe,"赠送给 "+r(d.friend.username),1),e("button",{onClick:E,class:"flex items-center justify-center w-8 h-8 text-gray-500 hover:text-red-500 hover:bg-red-50 rounded-full transition-all duration-200 hover:scale-110 focus:outline-none focus:ring-2 focus:ring-red-200",title:"关闭","aria-label":"关闭礼物选择"},i[15]||(i[15]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","stroke-width":"2.5"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"})],-1)]))]),e("div",Ke,[e("div",Ye,[e("button",{onClick:i[4]||(i[4]=s=>v.value="pet"),class:m(["flex-1 py-2 px-4 rounded-lg border transition-colors",v.value==="pet"?"bg-blue-500 text-white border-blue-500":"bg-gray-100 text-gray-700 border-gray-300 hover:bg-gray-200"])}," 🐾 宠物 ",2),e("button",{onClick:i[5]||(i[5]=s=>v.value="box"),class:m(["flex-1 py-2 px-4 rounded-lg border transition-colors",v.value==="box"?"bg-blue-500 text-white border-blue-500":"bg-gray-100 text-gray-700 border-gray-300 hover:bg-gray-200"])}," 📦 盲盒 ",2)]),v.value==="pet"?(n(),a("div",Je,[(n(!0),a(w,null,k(j.value,s=>{var y;return n(),a("div",{key:s.id,onClick:P=>f.value=s,class:m(["flex items-center space-x-3 p-3 border rounded-lg cursor-pointer transition-colors",((y=f.value)==null?void 0:y.id)===s.id?"border-blue-500 bg-blue-50":"border-gray-200 hover:bg-gray-50"])},[e("div",Xe,[e("img",{src:s.pet.babyImageUrl,alt:s.pet.name,class:"w-full h-full object-cover"},null,8,Ze)]),e("div",et,[e("h4",tt,r(s.nickname||s.pet.name),1),e("div",st,[e("span",{class:m(["rarity-badge text-xs",L(s.pet.rarity)])},r(s.pet.rarity),3),e("span",ot,r(s.status==="ADULT"?"成体":"幼体"),1)])])],10,Qe)}),128))])):(n(),a("div",nt,[(n(!0),a(w,null,k(U.value,s=>{var y;return n(),a("div",{key:s.id,onClick:P=>f.value=s,class:m(["flex items-center justify-between p-3 border rounded-lg cursor-pointer transition-colors",((y=f.value)==null?void 0:y.id)===s.id?"border-blue-500 bg-blue-50":"border-gray-200 hover:bg-gray-50"])},[e("div",lt,[e("img",{src:s.image,alt:s.name,class:"w-12 h-12 rounded-lg object-cover"},null,8,it),e("div",null,[e("h4",rt,r(s.name),1),e("p",ct,r(s.price)+" 积分",1)])])],10,at)}),128))])),B(e("textarea",{"onUpdate:modelValue":i[6]||(i[6]=s=>D.value=s),placeholder:"写点什么给你的朋友...",class:"w-full p-3 border rounded-lg text-sm resize-none focus:outline-none focus:border-blue-500",rows:"3"},null,512),[[N,D.value]]),e("div",dt,[e("button",{onClick:H,disabled:!f.value,class:"flex-1 py-2 px-4 bg-pink-500 text-white rounded-lg font-medium hover:bg-pink-600 transition-colors disabled:bg-gray-300 disabled:cursor-not-allowed"}," 🎁 发送礼物 ",8,ut),e("button",{onClick:E,class:"px-4 py-2 bg-gray-200 text-gray-700 rounded-lg font-medium hover:bg-gray-300 transition-colors"}," 取消 ")])])])])):g("",!0)]))}}),vt=re(pt,[["__scopeId","data-v-a517f41f"]]),mt={class:"container mx-auto px-4 py-8"},ft={key:0,class:"text-center py-16"},yt={key:1},xt={class:"card mb-8"},bt={class:"border-b",style:{"border-color":"var(--color-border)"}},gt={class:"flex space-x-8 px-6"},ht=["onClick"],_t={class:"p-6"},wt={key:0},kt={class:"flex justify-between items-center mb-6"},$t={class:"text-lg font-semibold",style:{color:"var(--color-text-primary)"}},Ct={key:0,class:"text-center py-16"},It={key:1,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"},St={class:"flex items-center space-x-3 mb-3"},At={class:"w-12 h-12 rounded-full flex items-center justify-center",style:{background:"var(--color-accent)"}},Dt={class:"text-white font-bold"},Ot={class:"flex-1"},Mt={class:"font-semibold",style:{color:"var(--color-text-primary)"}},jt={class:"text-sm",style:{color:"var(--color-text-secondary)"}},Ut={class:"flex space-x-2"},Rt=["onClick"],Pt=["onClick"],Tt=["onClick"],Et={key:1},Ft={key:0,class:"text-center py-16"},Lt={key:1,class:"space-y-4"},Vt={class:"flex items-center justify-between"},Gt={class:"flex items-center space-x-3"},Bt={class:"w-10 h-10 rounded-full flex items-center justify-center",style:{background:"var(--color-accent)"}},Nt={class:"text-white font-bold"},zt={class:"font-semibold",style:{color:"var(--color-text-primary)"}},Ht={class:"text-sm",style:{color:"var(--color-text-secondary)"}},Wt={class:"flex space-x-2"},qt=["onClick"],Kt=["onClick"],Yt={key:2},Jt={key:0,class:"text-center py-16"},Qt={key:1,class:"space-y-4"},Xt=["onClick"],Zt={class:"flex items-center space-x-3"},es={class:"w-12 h-12 rounded-full flex items-center justify-center",style:{background:"var(--color-accent)"}},ts={class:"text-white font-bold"},ss={class:"flex-1"},os={class:"flex justify-between items-start"},ns={class:"font-semibold",style:{color:"var(--color-text-primary)"}},as={class:"text-xs",style:{color:"var(--color-text-secondary)"}},ls={class:"text-sm truncate",style:{color:"var(--color-text-secondary)"}},is={key:0,class:"w-6 h-6 rounded-full flex items-center justify-center text-xs text-white",style:{background:"var(--color-accent)"}},rs={key:2,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},cs={class:"modal-content p-6 max-w-md w-full mx-4"},ds={class:"space-y-4"},us={key:0,class:"space-y-2 max-h-48 overflow-y-auto"},ps={class:"flex items-center space-x-3"},vs={class:"w-8 h-8 rounded-full flex items-center justify-center text-lg",style:{background:"var(--color-accent)"}},ms={key:0},fs={key:1,class:"text-white font-bold text-sm"},ys={class:"font-medium"},xs=["onClick","disabled"],bs={class:"flex gap-2 mt-6"},gs={key:3,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},hs={class:"modal-content p-6 max-w-md w-full mx-4"},_s={class:"text-lg font-bold mb-4"},ws={class:"space-y-4"},ks={class:"flex space-x-4"},$s={key:0,class:"space-y-2 max-h-48 overflow-y-auto"},Cs=["onClick"],Is={class:"w-12 h-12 rounded-lg overflow-hidden"},Ss=["src","alt"],As={class:"font-medium"},Ds={key:1,class:"space-y-2"},Os=["onClick"],Ms={class:"flex items-center space-x-3"},js=["src","alt"],Us={class:"font-medium"},Rs={class:"text-sm text-gray-600"},Es=Q({__name:"FriendsView",setup(K){const z=ce(),F=de(),O=c("friends"),h=c(!1),A=c(!1),M=c(!1),C=c(""),v=c([]),f=c(null),D=c(null),b=c("pet"),j=c(null),U=c(null),x=c(""),L=[{id:"friends",name:"好友列表"},{id:"requests",name:"好友请求"},{id:"chats",name:"聊天记录"}],I=c([]),$=c([]),V=c(!0),G=c([{friendId:"1",friend:{id:"1",username:"player1",isOnline:!0},lastMessage:"你的新宠物好可爱！",lastMessageTime:new Date(Date.now()-30*60*1e3).toISOString(),unreadCount:2}]),E=c([{id:"1",userId:"current-user",petId:"1",isAdult:!1,nickname:"小可爱",createdAt:new Date().toISOString(),status:"BABY",growthValue:50,maxGrowth:100,pet:{id:"1",name:"小精灵",description:"可爱的小精灵",rarity:"N",babyImageUrl:"https://images.unsplash.com/photo-1578662996442-48f60103fc96?w=300&h=300&fit=crop",adultImageUrl:"https://images.unsplash.com/photo-1578662996442-48f60103fc96?w=300&h=300&fit=crop",story:"森林中的小精灵",seriesId:1,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),series:{id:1,name:"森林精灵系列",description:"来自神秘森林的精灵们",coverImageUrl:"https://images.unsplash.com/photo-1441974231531-c6227db76b6e?w=100&h=100&fit=crop",drawPrice:100,isActive:!0,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()}}}]),H=c([{id:1,name:"森林精灵系列",description:"来自神秘森林的精灵们",coverImageUrl:"https://images.unsplash.com/photo-1441974231531-c6227db76b6e?w=100&h=100&fit=crop",drawPrice:100,isActive:!0,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()}]),S=l=>({N:"rarity-badge-n",R:"rarity-badge-r",SR:"rarity-badge-sr",SSR:"rarity-badge-ssr",UR:"rarity-badge-ur"})[l]||"rarity-badge-n",d=l=>{const o=new Date(l),t=Math.floor((new Date().getTime()-o.getTime())/(1e3*60*60));return t<1?"刚刚":t<24?`${t}小时前`:`${Math.floor(t/24)}天前`},i=async()=>{if(v.value.length===0)try{const{usersApi:l}=await R(async()=>{const{usersApi:u}=await import("./users-BOqreVSi.js");return{usersApi:u}},__vite__mapDeps([0,1,2])),o=await l.searchUsers("");v.value=o}catch(l){console.error("加载用户列表失败:",l)}},s=async()=>{if(!C.value.trim()){await i();return}try{const{usersApi:l}=await R(async()=>{const{usersApi:u}=await import("./users-BOqreVSi.js");return{usersApi:u}},__vite__mapDeps([0,1,2])),o=await l.searchUsers(C.value.trim());v.value=o}catch(l){console.error("搜索用户失败:",l),v.value=[]}},y=async l=>{var o,u;try{const{socialAPI:t}=await R(async()=>{const{socialAPI:p}=await import("./index-o0ffgrYm.js").then(_=>_.N);return{socialAPI:p}},__vite__mapDeps([1,2]));await t.sendFriendRequest(l.id),l.requestSent=!0,alert(`已向 ${l.username} 发送好友请求！`)}catch(t){console.error("发送好友请求失败:",t),alert(((u=(o=t.response)==null?void 0:o.data)==null?void 0:u.message)||"发送好友请求失败")}},P=async l=>{var o,u;try{const{socialAPI:t}=await R(async()=>{const{socialAPI:_}=await import("./index-o0ffgrYm.js").then(W=>W.N);return{socialAPI:_}},__vite__mapDeps([1,2]));await t.acceptFriendRequest(l.id),I.value.push({id:l.sender.id,username:l.sender.username,isOnline:Math.random()>.5,avatar:l.sender.avatar});const p=$.value.findIndex(_=>_.id===l.id);p>-1&&$.value.splice(p,1),alert(`已接受 ${l.sender.username} 的好友请求！`)}catch(t){console.error("接受好友请求失败:",t),alert(((u=(o=t.response)==null?void 0:o.data)==null?void 0:u.message)||"接受好友请求失败")}},Z=async l=>{var o,u;try{const{socialAPI:t}=await R(async()=>{const{socialAPI:_}=await import("./index-o0ffgrYm.js").then(W=>W.N);return{socialAPI:_}},__vite__mapDeps([1,2]));await t.rejectFriendRequest(l.id);const p=$.value.findIndex(_=>_.id===l.id);p>-1&&$.value.splice(p,1),alert(`已拒绝 ${l.sender.username} 的好友请求`)}catch(t){console.error("拒绝好友请求失败:",t),alert(((u=(o=t.response)==null?void 0:o.data)==null?void 0:u.message)||"拒绝好友请求失败")}},ee=l=>{if(confirm(`确定要删除好友 ${l.username} 吗？`)){const o=I.value.findIndex(u=>u.id===l.id);o>-1&&I.value.splice(o,1),console.log("删除好友:",l.username)}},Y=l=>{D.value=l,M.value=!0},te=()=>{M.value=!1,D.value=null},se=l=>{f.value=l,A.value=!0},J=()=>{A.value=!1,f.value=null,j.value=null,U.value=null,x.value="",b.value="pet"},oe=()=>{var l;if(b.value==="pet"&&!j.value){alert("请选择要赠送的宠物");return}if(b.value==="box"&&!U.value){alert("请选择要赠送的盲盒系列");return}console.log("赠送礼物:",{to:(l=f.value)==null?void 0:l.username,type:b.value,item:b.value==="pet"?j.value:U.value,message:x.value}),alert("礼物已发送！"),J()},ne=async()=>{try{const{socialAPI:l}=await R(async()=>{const{socialAPI:o}=await import("./index-o0ffgrYm.js").then(u=>u.N);return{socialAPI:o}},__vite__mapDeps([1,2]));I.value=await l.getFriends()}catch(l){console.error("加载好友列表失败:",l)}},ae=async()=>{try{const{socialAPI:l}=await R(async()=>{const{socialAPI:o}=await import("./index-o0ffgrYm.js").then(u=>u.N);return{socialAPI:o}},__vite__mapDeps([1,2]));$.value=await l.getFriendRequests()}catch(l){console.error("加载好友请求失败:",l)}};return X(async()=>{if(z.isAuthenticated)try{V.value=!0,await Promise.all([ne(),ae()])}catch(l){console.error("加载数据失败:",l)}finally{V.value=!1}}),(l,o)=>{var u;return n(),a("div",mt,[o[16]||(o[16]=e("div",{class:"text-center mb-8"},[e("h1",{class:"mb-4",style:{"font-family":"var(--font-heading)","font-size":"var(--text-4xl)",color:"var(--color-text-primary)","font-weight":"900"}}," 👥 好友系统 "),e("p",{style:{"font-size":"var(--text-lg)",color:"var(--color-text-secondary)","font-family":"var(--font-body)"}}," 与朋友一起分享宠物收藏的乐趣 ")],-1)),q(z).isAuthenticated?(n(),a("div",yt,[e("div",xt,[e("div",bt,[e("nav",gt,[(n(),a(w,null,k(L,t=>e("button",{key:t.id,onClick:p=>O.value=t.id,class:m(["py-4 px-2 border-b-2 font-medium text-sm transition-colors",O.value===t.id?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"])},r(t.name),11,ht)),64))])]),e("div",_t,[O.value==="friends"?(n(),a("div",wt,[e("div",kt,[e("h3",$t,"我的好友 ("+r(I.value.length)+")",1),e("button",{onClick:o[1]||(o[1]=t=>h.value=!0),class:"btn btn-primary"}," ➕ 添加好友 ")]),I.value.length===0?(n(),a("div",Ct,o[10]||(o[10]=[e("div",{class:"text-6xl mb-4"},"👥",-1),e("h3",{class:"text-xl font-semibold mb-2"},"还没有好友",-1),e("p",{class:"text-gray-600 mb-4"},"快去添加一些朋友吧！",-1)]))):(n(),a("div",It,[(n(!0),a(w,null,k(I.value,t=>(n(),a("div",{key:t.id,class:"card p-4"},[e("div",St,[e("div",At,[e("span",Dt,r(t.username[0].toUpperCase()),1)]),e("div",Ot,[e("h4",Mt,r(t.username),1),e("p",jt,[e("span",{class:m(t.isOnline?"text-green-500":"text-gray-400")},r(t.isOnline?"在线":"离线"),3)])])]),e("div",Ut,[e("button",{onClick:p=>Y(t),class:"flex-1 btn btn-primary text-sm"}," 💬 聊天 ",8,Rt),e("button",{onClick:p=>se(t),class:"flex-1 btn btn-secondary text-sm"}," 🎁 赠送 ",8,Pt),e("button",{onClick:p=>ee(t),class:"btn text-sm px-3",style:{"background-color":"#fee",color:"#dc2626",border:"1px solid #fecaca"},title:"删除好友"}," 🗑️ ",8,Tt)])]))),128))]))])):O.value==="requests"?(n(),a("div",Et,[o[12]||(o[12]=e("h3",{class:"text-lg font-semibold mb-6",style:{color:"var(--color-text-primary)"}},"好友请求",-1)),$.value.length===0?(n(),a("div",Ft,o[11]||(o[11]=[e("div",{class:"text-6xl mb-4"},"📬",-1),e("h3",{class:"text-xl font-semibold mb-2"},"暂无好友请求",-1),e("p",{class:"text-gray-600"},"当有人想加你为好友时，会在这里显示",-1)]))):(n(),a("div",Lt,[(n(!0),a(w,null,k($.value,t=>(n(),a("div",{key:t.id,class:"card p-4"},[e("div",Vt,[e("div",Gt,[e("div",Bt,[e("span",Nt,r(t.sender.username[0].toUpperCase()),1)]),e("div",null,[e("h4",zt,r(t.sender.username),1),e("p",Ht,r(d(t.createdAt)),1)])]),e("div",Wt,[e("button",{onClick:p=>P(t),class:"btn btn-primary text-sm"}," ✅ 接受 ",8,qt),e("button",{onClick:p=>Z(t),class:"btn btn-secondary text-sm"}," ❌ 拒绝 ",8,Kt)])])]))),128))]))])):O.value==="chats"?(n(),a("div",Yt,[o[14]||(o[14]=e("h3",{class:"text-lg font-semibold mb-6",style:{color:"var(--color-text-primary)"}},"最近聊天",-1)),G.value.length===0?(n(),a("div",Jt,o[13]||(o[13]=[e("div",{class:"text-6xl mb-4"},"💬",-1),e("h3",{class:"text-xl font-semibold mb-2"},"暂无聊天记录",-1),e("p",{class:"text-gray-600"},"与好友开始聊天吧！",-1)]))):(n(),a("div",Qt,[(n(!0),a(w,null,k(G.value,t=>(n(),a("div",{key:t.friendId,onClick:p=>Y(t.friend),class:"card p-4 cursor-pointer hover:shadow-lg transition-shadow"},[e("div",Zt,[e("div",es,[e("span",ts,r(t.friend.username[0].toUpperCase()),1)]),e("div",ss,[e("div",os,[e("h4",ns,r(t.friend.username),1),e("span",as,r(d(t.lastMessageTime)),1)]),e("p",ls,r(t.lastMessage),1)]),t.unreadCount>0?(n(),a("div",is,r(t.unreadCount),1)):g("",!0)])],8,Xt))),128))]))])):g("",!0)])])])):(n(),a("div",ft,[o[7]||(o[7]=e("div",{class:"text-6xl mb-4"},"🔒",-1)),o[8]||(o[8]=e("h3",{class:"text-xl font-semibold mb-2"},"请先登录",-1)),o[9]||(o[9]=e("p",{class:"text-gray-600 mb-4"},"登录后查看你的好友列表",-1)),e("button",{onClick:o[0]||(o[0]=(...t)=>q(F).openLoginModal&&q(F).openLoginModal(...t)),class:"btn btn-primary"}," 登录 ")])),h.value?(n(),a("div",rs,[e("div",cs,[o[15]||(o[15]=e("h3",{class:"text-lg font-bold mb-4"},"添加好友",-1)),e("div",ds,[B(e("input",{"onUpdate:modelValue":o[2]||(o[2]=t=>C.value=t),type:"text",placeholder:"输入用户名搜索...",class:"input w-full",onInput:s,onFocus:i},null,544),[[N,C.value]]),v.value.length>0?(n(),a("div",us,[(n(!0),a(w,null,k(v.value,t=>(n(),a("div",{key:t.id,class:"flex items-center justify-between p-3 border rounded-lg"},[e("div",ps,[e("div",vs,[t.avatar?(n(),a("span",ms,r(t.avatar),1)):(n(),a("span",fs,r(t.username[0].toUpperCase()),1))]),e("span",ys,r(t.username),1)]),e("button",{onClick:p=>y(t),disabled:t.isFriend||t.requestSent,class:"btn btn-primary text-sm"},r(t.isFriend?"已是好友":t.requestSent?"已发送":"添加"),9,xs)]))),128))])):g("",!0)]),e("div",bs,[e("button",{onClick:o[3]||(o[3]=t=>h.value=!1),class:"flex-1 btn btn-secondary"},"取消")])])])):g("",!0),A.value?(n(),a("div",gs,[e("div",hs,[e("h3",_s,"赠送给 "+r((u=f.value)==null?void 0:u.username),1),e("div",ws,[e("div",ks,[e("button",{onClick:o[4]||(o[4]=t=>b.value="pet"),class:m(["flex-1 btn",b.value==="pet"?"btn-primary":"btn-secondary"])}," 🐾 宠物 ",2),e("button",{onClick:o[5]||(o[5]=t=>b.value="box"),class:m(["flex-1 btn",b.value==="box"?"btn-primary":"btn-secondary"])}," 📦 盲盒 ",2)]),b.value==="pet"?(n(),a("div",$s,[(n(!0),a(w,null,k(E.value,t=>{var p;return n(),a("div",{key:t.id,onClick:_=>j.value=t,class:m(["flex items-center space-x-3 p-3 border rounded-lg cursor-pointer",((p=j.value)==null?void 0:p.id)===t.id?"border-blue-500 bg-blue-50":""])},[e("div",Is,[e("img",{src:t.pet.babyImageUrl,alt:t.pet.name,class:"w-full h-full object-cover"},null,8,Ss)]),e("div",null,[e("h4",As,r(t.nickname||t.pet.name),1),e("span",{class:m(["rarity-badge text-xs",S(t.pet.rarity)])},r(t.pet.rarity),3)])],10,Cs)}),128))])):(n(),a("div",Ds,[(n(!0),a(w,null,k(H.value,t=>{var p;return n(),a("div",{key:t.id,onClick:_=>U.value=t,class:m(["flex items-center justify-between p-3 border rounded-lg cursor-pointer",((p=U.value)==null?void 0:p.id)===t.id?"border-blue-500 bg-blue-50":""])},[e("div",Ms,[e("img",{src:t.coverImageUrl,alt:t.name,class:"w-12 h-12 rounded-lg object-cover"},null,8,js),e("div",null,[e("h4",Us,r(t.name),1),e("p",Rs,r(t.drawPrice)+" 积分",1)])])],10,Os)}),128))])),B(e("textarea",{"onUpdate:modelValue":o[6]||(o[6]=t=>x.value=t),placeholder:"写点什么给你的朋友...",class:"input w-full h-20 resize-none"},null,512),[[N,x.value]])]),e("div",{class:"flex gap-2 mt-6"},[e("button",{onClick:oe,class:"flex-1 btn btn-primary"},"🎁 赠送"),e("button",{onClick:J,class:"flex-1 btn btn-secondary"},"取消")])])])):g("",!0),M.value&&D.value?(n(),ue(vt,{key:4,friend:D.value,onClose:te},null,8,["friend"])):g("",!0)])}}});export{Es as default};
