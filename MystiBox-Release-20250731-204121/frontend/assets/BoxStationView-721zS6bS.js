const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-o0ffgrYm.js","assets/index-CTc8BNRK.css"])))=>i.map(i=>d[i]);
import{d as st,q as ot,r as i,f as v,g as lt,A as at,c as a,a as e,m as c,t as d,w as m,v as P,h as T,F as V,i as I,x as nt,l as rt,C as it,E as dt,p as ct,e as ut,o as n,_ as vt}from"./index-o0ffgrYm.js";import{b as D}from"./boxes-CujsuhC3.js";const mt={class:"container mx-auto px-4 py-8"},xt={class:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8"},pt={class:"card p-6 text-center"},ft={class:"text-2xl font-bold",style:{color:"var(--color-text-primary)"}},yt={class:"card p-6 text-center"},bt={class:"text-2xl font-bold",style:{color:"var(--color-text-primary)"}},gt={class:"card p-6 text-center"},wt={class:"text-2xl font-bold",style:{color:"var(--color-text-primary)"}},_t={class:"card p-6 text-center"},ht={class:"text-2xl font-bold",style:{color:"var(--color-text-primary)"}},kt={class:"card p-4 mb-8"},Ct={class:"flex flex-col md:flex-row gap-4 items-center"},Dt={class:"flex-1"},Et={class:"flex gap-4"},Nt=["value"],Bt={key:0,class:"text-center py-8"},At={key:1,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6"},Pt={class:"aspect-square relative"},Tt=["src","alt"],Vt={class:"absolute top-2 left-2"},It={class:"bg-black/70 text-white px-2 py-1 rounded text-xs font-bold"},St={class:"absolute top-2 right-2"},Mt={class:"bg-yellow-500 text-white px-2 py-1 rounded text-xs font-bold"},Ut={key:0,class:"absolute bottom-2 left-2"},Ot={class:"p-4"},Gt={class:"font-semibold mb-2",style:{color:"var(--color-text-primary)"}},Ft={class:"text-sm mb-3",style:{color:"var(--color-text-secondary)"}},Rt={class:"flex gap-2"},zt=["onClick"],Lt=["onClick"],$t=["onClick"],jt=["onClick"],qt={key:2,class:"text-center py-16"},Qt={key:3,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50"},Ht={class:"bg-white rounded-xl p-8 max-w-md w-full mx-4"},Jt={class:"text-center"},Kt={class:"text-gray-600 mb-6"},Wt={class:"flex gap-4"},Xt={key:4,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50"},Yt={class:"bg-white rounded-xl p-8 max-w-md w-full mx-4"},Zt={class:"text-center"},te={class:"text-gray-600 mb-6"},ee={class:"mb-4"},se={class:"flex gap-4"},oe={key:5,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50"},le={class:"bg-white rounded-xl p-8 max-w-md w-full mx-4"},ae={class:"text-center"},ne={class:"text-gray-600 mb-6"},re={class:"mb-4"},ie=["value"],de={class:"mb-4"},ce={class:"flex gap-4"},ue=["disabled"],ve=st({__name:"BoxStationView",setup(me){const F=ot(),S=at(),y=i(""),b=i(""),E=i("newest"),g=i(!1),w=i(!1),_=i(!1),r=i(null),h=i(""),k=i(""),u=i(""),N=i([]),C=i({totalBoxes:0,openedBoxes:0,tradingBoxes:0,giftedBoxes:0,totalValue:0}),M=i([]),B=i(!0),R=v(()=>{const s=new Map;return N.value.forEach(t=>{s.has(t.series.id)||s.set(t.series.id,t.series)}),Array.from(s.values())}),U=v(()=>{let s=N.value;if(y.value){const t=y.value.toLowerCase();s=s.filter(l=>l.series.name.toLowerCase().includes(t))}return b.value&&(s=s.filter(t=>t.series.id.toString()===b.value)),s.sort((t,l)=>{switch(E.value){case"newest":return new Date(l.obtainedAt).getTime()-new Date(t.obtainedAt).getTime();case"oldest":return new Date(t.obtainedAt).getTime()-new Date(l.obtainedAt).getTime();case"value":return l.series.drawPrice-t.series.drawPrice;case"series":return t.series.name.localeCompare(l.series.name);default:return 0}}),s}),z=v(()=>C.value.totalBoxes),L=v(()=>C.value.totalValue),$=v(()=>0),j=v(()=>C.value.tradingBoxes),q=s=>new Date(s).toLocaleDateString("zh-CN",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),Q=s=>{switch(s){case"TRADING":return"bg-blue-500";case"GIFTED":return"bg-green-500";case"OPENED":return"bg-gray-500";default:return"bg-gray-500"}},H=s=>{switch(s){case"TRADING":return"交易中";case"GIFTED":return"已赠送";case"OPENED":return"已开封";default:return"未知"}},J=s=>{r.value=s,g.value=!0},K=async()=>{var s,t;if(r.value)try{const l=await D.openBox(r.value.id);alert(l.message),r.value.status="OPENED",g.value=!1,r.value=null,await x(),await p(),S.push("/my-pets")}catch(l){console.error("开封失败:",l),alert(((t=(s=l.response)==null?void 0:s.data)==null?void 0:t.message)||"开封失败，请稍后重试")}},W=s=>{r.value=s,w.value=!0},X=async()=>{if(r.value)try{console.log("发起交易:",r.value.id,h.value),r.value.status="TRADING",w.value=!1,r.value=null,h.value="",await x(),await p(),alert("交易请求已发布到广场！")}catch(s){console.error("发起交易失败:",s),alert("发起交易失败，请稍后重试")}},Y=async s=>{var t,l;if(confirm("确定要撤销这个交易吗？"))try{console.log("撤销交易:",s.id),s.status="UNOPENED",await x(),await p(),alert("交易已撤销！")}catch(f){console.error("撤销交易失败:",f),alert(((l=(t=f.response)==null?void 0:t.data)==null?void 0:l.message)||"撤销交易失败，请稍后重试")}},Z=s=>{r.value=s,_.value=!0},tt=async()=>{var s,t;if(!(!r.value||!u.value))try{const l=await D.giftBox(r.value.id,u.value,k.value);alert(l.message),await x(),await p(),_.value=!1,r.value=null,u.value="",k.value=""}catch(l){console.error("赠送失败:",l),alert(((t=(s=l.response)==null?void 0:s.data)==null?void 0:t.message)||"赠送失败，请稍后重试")}},x=async()=>{try{N.value=await D.getMyBoxes()}catch(s){console.error("加载盲盒列表失败:",s)}},p=async()=>{try{C.value=await D.getStats()}catch(s){console.error("加载统计信息失败:",s)}},et=async()=>{try{const{socialAPI:s}=await dt(async()=>{const{socialAPI:t}=await import("./index-o0ffgrYm.js").then(l=>l.N);return{socialAPI:t}},__vite__mapDeps([0,1]));M.value=await s.getFriends()}catch(s){console.error("加载好友列表失败:",s)}};return lt(async()=>{if(!F.isAuthenticated){S.push("/login");return}try{B.value=!0,await Promise.all([x(),p(),et()])}catch(s){console.error("加载数据失败:",s)}finally{B.value=!1}}),(s,t)=>{var f,O,G;const l=it("RouterLink");return n(),a("div",mt,[t[31]||(t[31]=e("div",{class:"text-center mb-8"},[e("h1",{class:"mb-4",style:{"font-family":"var(--font-heading)","font-size":"var(--text-4xl)",color:"var(--color-text-primary)","font-weight":"900"}}," 📦 盲盒驿站 "),e("p",{style:{"font-size":"var(--text-lg)",color:"var(--color-text-secondary)","font-family":"var(--font-body)"}}," 管理你的盲盒收藏，开封、交易、赠送 ")],-1)),e("div",xt,[e("div",pt,[t[9]||(t[9]=e("div",{class:"text-3xl mb-2"},"📦",-1)),e("div",ft,d(z.value),1),t[10]||(t[10]=e("div",{class:"text-sm",style:{color:"var(--color-text-secondary)"}},"未开封盲盒",-1))]),e("div",yt,[t[11]||(t[11]=e("div",{class:"text-3xl mb-2"},"✨",-1)),e("div",bt,d(L.value),1),t[12]||(t[12]=e("div",{class:"text-sm",style:{color:"var(--color-text-secondary)"}},"总价值",-1))]),e("div",gt,[t[13]||(t[13]=e("div",{class:"text-3xl mb-2"},"🎁",-1)),e("div",wt,d($.value),1),t[14]||(t[14]=e("div",{class:"text-sm",style:{color:"var(--color-text-secondary)"}},"待处理礼物",-1))]),e("div",_t,[t[15]||(t[15]=e("div",{class:"text-3xl mb-2"},"🔄",-1)),e("div",ht,d(j.value),1),t[16]||(t[16]=e("div",{class:"text-sm",style:{color:"var(--color-text-secondary)"}},"交易中",-1))])]),e("div",kt,[e("div",Ct,[e("div",Dt,[m(e("input",{"onUpdate:modelValue":t[0]||(t[0]=o=>y.value=o),type:"text",placeholder:"搜索盲盒系列...",class:"input w-full"},null,512),[[P,y.value]])]),e("div",Et,[m(e("select",{"onUpdate:modelValue":t[1]||(t[1]=o=>b.value=o),class:"input"},[t[17]||(t[17]=e("option",{value:""},"全部系列",-1)),(n(!0),a(V,null,I(R.value,o=>(n(),a("option",{key:o.id,value:o.id},d(o.name),9,Nt))),128))],512),[[T,b.value]]),m(e("select",{"onUpdate:modelValue":t[2]||(t[2]=o=>E.value=o),class:"input"},t[18]||(t[18]=[e("option",{value:"newest"},"最新获得",-1),e("option",{value:"oldest"},"最早获得",-1),e("option",{value:"value"},"按价值排序",-1),e("option",{value:"series"},"按系列排序",-1)]),512),[[T,E.value]])])])]),B.value?(n(),a("div",Bt,t[19]||(t[19]=[e("div",{class:"inline-block animate-spin rounded-full h-8 w-8 border-b-2",style:{"border-color":"var(--color-accent)"}},null,-1),e("p",{class:"mt-2",style:{color:"var(--color-text-secondary)"}},"加载中...",-1)]))):(n(),a("div",At,[(n(!0),a(V,null,I(U.value,o=>(n(),a("div",{key:o.id,class:"card overflow-hidden hover:shadow-lg transition-shadow"},[e("div",Pt,[e("img",{src:o.series.coverImageUrl,alt:o.series.name,class:"w-full h-full object-cover"},null,8,Tt),e("div",Vt,[e("span",It,d(o.series.name),1)]),e("div",St,[e("span",Mt," 💰"+d(o.series.drawPrice),1)]),o.status!=="UNOPENED"?(n(),a("div",Ut,[e("span",{class:ct([Q(o.status),"px-2 py-1 rounded text-xs font-bold text-white"])},d(H(o.status)),3)])):c("",!0)]),e("div",Ot,[e("h3",Gt,d(o.series.name),1),e("p",Ft," 获得时间："+d(q(o.obtainedAt)),1),e("div",Rt,[o.status==="UNOPENED"?(n(),a("button",{key:0,onClick:A=>J(o),class:"flex-1 btn btn-primary text-sm"}," 🎁 开封 ",8,zt)):c("",!0),o.status==="UNOPENED"?(n(),a("button",{key:1,onClick:A=>W(o),class:"btn btn-secondary text-sm"}," 🔄 交易 ",8,Lt)):c("",!0),o.status==="UNOPENED"?(n(),a("button",{key:2,onClick:A=>Z(o),class:"btn btn-secondary text-sm"}," 🎁 赠送 ",8,$t)):c("",!0),o.status==="TRADING"?(n(),a("button",{key:3,onClick:A=>Y(o),class:"btn btn-warning text-sm"}," ❌ 撤销交易 ",8,jt)):c("",!0)])])]))),128))])),U.value.length===0?(n(),a("div",qt,[t[21]||(t[21]=e("div",{class:"text-6xl mb-4"},"📦",-1)),t[22]||(t[22]=e("h3",{class:"text-xl font-semibold mb-2"},"暂无盲盒",-1)),t[23]||(t[23]=e("p",{class:"text-gray-600 mb-4"},"去商店购买一些盲盒吧！",-1)),nt(l,{to:"/store",class:"btn btn-primary"},{default:rt(()=>t[20]||(t[20]=[ut(" 前往商店 ",-1)])),_:1,__:[20]})])):c("",!0),g.value?(n(),a("div",Qt,[e("div",Ht,[e("div",Jt,[t[24]||(t[24]=e("div",{class:"text-6xl mb-4"},"🎁",-1)),t[25]||(t[25]=e("h3",{class:"text-xl font-semibold mb-4"},"开封盲盒",-1)),e("p",Kt,"确定要开封这个 "+d((f=r.value)==null?void 0:f.series.name)+" 盲盒吗？",1),e("div",Wt,[e("button",{onClick:K,class:"flex-1 btn btn-primary"}," 确认开封 "),e("button",{onClick:t[3]||(t[3]=o=>g.value=!1),class:"flex-1 btn btn-secondary"}," 取消 ")])])])])):c("",!0),w.value?(n(),a("div",Xt,[e("div",Yt,[e("div",Zt,[t[26]||(t[26]=e("div",{class:"text-6xl mb-4"},"🔄",-1)),t[27]||(t[27]=e("h3",{class:"text-xl font-semibold mb-4"},"交易盲盒",-1)),e("p",te,"将 "+d((O=r.value)==null?void 0:O.series.name)+" 盲盒发起交易",1),e("div",ee,[m(e("input",{"onUpdate:modelValue":t[4]||(t[4]=o=>h.value=o),type:"text",placeholder:"交易说明（可选）",class:"input w-full"},null,512),[[P,h.value]])]),e("div",se,[e("button",{onClick:X,class:"flex-1 btn btn-primary"}," 发起交易 "),e("button",{onClick:t[5]||(t[5]=o=>w.value=!1),class:"flex-1 btn btn-secondary"}," 取消 ")])])])])):c("",!0),_.value?(n(),a("div",oe,[e("div",le,[e("div",ae,[t[29]||(t[29]=e("div",{class:"text-6xl mb-4"},"🎁",-1)),t[30]||(t[30]=e("h3",{class:"text-xl font-semibold mb-4"},"赠送盲盒",-1)),e("p",ne,"将 "+d((G=r.value)==null?void 0:G.series.name)+" 盲盒赠送给好友",1),e("div",re,[m(e("select",{"onUpdate:modelValue":t[6]||(t[6]=o=>u.value=o),class:"input w-full"},[t[28]||(t[28]=e("option",{value:""},"选择好友",-1)),(n(!0),a(V,null,I(M.value,o=>(n(),a("option",{key:o.id,value:o.id},d(o.username),9,ie))),128))],512),[[T,u.value]])]),e("div",de,[m(e("input",{"onUpdate:modelValue":t[7]||(t[7]=o=>k.value=o),type:"text",placeholder:"赠送留言（可选）",class:"input w-full"},null,512),[[P,k.value]])]),e("div",ce,[e("button",{onClick:tt,class:"flex-1 btn btn-primary",disabled:!u.value}," 确认赠送 ",8,ue),e("button",{onClick:t[8]||(t[8]=o=>_.value=!1),class:"flex-1 btn btn-secondary"}," 取消 ")])])])])):c("",!0)])}}}),fe=vt(ve,[["__scopeId","data-v-f3cddbb1"]]);export{fe as default};
