const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/pets-6Cicj7kR.js","assets/index-o0ffgrYm.js","assets/index-CTc8BNRK.css"])))=>i.map(i=>d[i]);
import{d as Y,r as u,c,a as e,t as r,p as V,w as x,v as U,m as $,B as oe,o as d,_ as se,q as le,u as ae,f as ne,g as ie,k as re,y as A,h as G,b as de,F,i as ue,x as ce,l as pe,C as ve,E as be,n as ge,e as me}from"./index-o0ffgrYm.js";import{u as q}from"./usePoints-CTAEdpGp.js";import{u as xe}from"./showcase-DDlJsfvZ.js";const fe={class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},he={class:"bg-white rounded-lg p-6 max-w-md w-full mx-4"},ye={class:"flex justify-between items-center mb-4"},we={class:"mb-4 p-4 bg-gray-50 rounded-lg"},_e={class:"flex items-center space-x-3"},ke={class:"w-16 h-16 rounded-lg overflow-hidden"},Se=["src","alt"],Ce={class:"font-semibold"},$e={class:"flex items-center space-x-2"},Ue={class:"text-xs text-gray-500"},Re={class:"mb-4"},Ae=["placeholder"],Ve={class:"text-right text-xs text-gray-500 mt-1"},Le={class:"mb-4"},Ne={class:"flex items-center space-x-2"},Me={key:0,class:"mt-2 ml-6"},Te={class:"flex gap-2"},Be=["disabled"],De=Y({__name:"ShareModal",props:{userPet:{}},emits:["close","share"],setup(L,{emit:f}){const h=L,k=f,{awardPoints:S}=q(),v=u(""),p=u(!1),m=u(500),b=u(!1),y=a=>{const l={N:"bg-gray-500 text-white",R:"bg-blue-500 text-white",SR:"bg-purple-500 text-white",SSR:"bg-yellow-500 text-white",UR:"bg-red-500 text-white"};return l[a]||l.N},w=async()=>{b.value=!0;try{await S("SHARE_PET"),k("share",{userPet:h.userPet,content:v.value||`我的${h.userPet.nickname||h.userPet.pet.name}已经长大啦！`,allowSale:p.value,salePrice:p.value?m.value:void 0}),k("close")}catch(a){console.error("分享失败:",a),alert("分享失败，请重试")}finally{b.value=!1}};return(a,l)=>(d(),c("div",fe,[e("div",he,[e("div",ye,[l[6]||(l[6]=e("h3",{class:"text-lg font-bold"},"分享到广场",-1)),e("button",{onClick:l[0]||(l[0]=i=>a.$emit("close")),class:"text-gray-500 hover:text-gray-700"},l[5]||(l[5]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))]),e("div",we,[e("div",_e,[e("div",ke,[e("img",{src:a.userPet.status==="ADULT"?a.userPet.pet.adultImageUrl:a.userPet.pet.babyImageUrl,alt:a.userPet.nickname||a.userPet.pet.name,class:"w-full h-full object-cover"},null,8,Se)]),e("div",null,[e("h4",Ce,r(a.userPet.nickname||a.userPet.pet.name),1),e("div",$e,[e("span",{class:V(["rarity-badge text-xs",y(a.userPet.pet.rarity)])},r(a.userPet.pet.rarity),3),e("span",Ue,r(a.userPet.status==="ADULT"?"成体":"幼体"),1)])])])]),e("div",Re,[l[7]||(l[7]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," 为你的小伙伴写点什么吧... ",-1)),x(e("textarea",{"onUpdate:modelValue":l[1]||(l[1]=i=>v.value=i),placeholder:`我的${a.userPet.nickname||a.userPet.pet.name}已经长大啦！`,class:"w-full h-20 px-3 py-2 border border-gray-300 rounded-lg resize-none focus:outline-none focus:border-blue-500",maxlength:"200"},null,8,Ae),[[U,v.value]]),e("div",Ve,r(v.value.length)+"/200 ",1)]),e("div",Le,[e("label",Ne,[x(e("input",{"onUpdate:modelValue":l[2]||(l[2]=i=>p.value=i),type:"checkbox",class:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"},null,512),[[oe,p.value]]),l[8]||(l[8]=e("span",{class:"text-sm"},"允许其他玩家购买",-1))]),p.value?(d(),c("div",Me,[l[9]||(l[9]=e("label",{class:"block text-sm text-gray-600 mb-1"},"售价（积分）",-1)),x(e("input",{"onUpdate:modelValue":l[3]||(l[3]=i=>m.value=i),type:"number",min:"1",max:"10000",class:"w-24 px-2 py-1 border border-gray-300 rounded text-sm focus:outline-none focus:border-blue-500"},null,512),[[U,m.value,void 0,{number:!0}]])])):$("",!0)]),e("div",Te,[e("button",{onClick:w,disabled:b.value,class:"flex-1 py-2 px-4 bg-blue-500 text-white rounded-lg font-medium hover:bg-blue-600 transition-colors disabled:bg-gray-300 disabled:cursor-not-allowed"},r(b.value?"分享中...":"🌟 分享到广场"),9,Be),e("button",{onClick:l[4]||(l[4]=i=>a.$emit("close")),class:"px-4 py-2 bg-gray-200 text-gray-700 rounded-lg font-medium hover:bg-gray-300 transition-colors"}," 取消 ")])])]))}}),Ee=se(De,[["__scopeId","data-v-56d6ac9a"]]),Ie={class:"container mx-auto px-4 py-8"},je={class:"text-center mb-8"},ze={style:{"font-size":"var(--text-lg)",color:"var(--color-text-secondary)","font-family":"var(--font-body)"}},Ge={key:0},Fe={class:"card p-4 mb-8"},Ye={class:"flex flex-col md:flex-row gap-4 items-center"},qe={class:"flex gap-4"},Oe={class:"flex-1"},Pe={key:0,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6"},He={class:"aspect-square relative"},Qe=["src","alt"],Je={class:"absolute top-2 right-2"},Ke={class:"absolute top-2 left-2"},We={class:"p-4"},Xe={class:"font-bold text-lg mb-2"},Ze={class:"text-gray-600 text-sm mb-3"},et={class:"mb-3"},tt={class:"flex justify-between text-sm mb-1"},ot={class:"w-full bg-gray-200 rounded-full h-2"},st={class:"flex gap-2"},lt=["onClick"],at=["onClick"],nt=["onClick","disabled"],it=["onClick"],rt=["onClick"],dt={key:1,class:"text-center py-16"},ut={key:1,class:"text-center py-16"},ct={key:2,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},pt={class:"bg-white rounded-lg p-6 max-w-md w-full mx-4"},vt=["placeholder"],xt=Y({__name:"MyPetsView",setup(L){const f=le(),h=ae(),k=xe(),{awardPoints:S}=q(),v=u([]),p=u(""),m=u(""),b=u(""),y=u(!1),w=u(!1),a=u(null),l=u(null),i=u(""),N=ne(()=>{let o=v.value;if(p.value&&(o=o.filter(t=>{var n;return((n=t.pet)==null?void 0:n.rarity)===p.value})),m.value&&(o=o.filter(t=>t.status===m.value)),b.value){const t=b.value.toLowerCase();o=o.filter(n=>{var g,_;return(n.nickname||((g=n.pet)==null?void 0:g.name)||"").toLowerCase().includes(t)||(((_=n.pet)==null?void 0:_.name)||"").toLowerCase().includes(t)})}return o}),O=o=>{const t={N:"bg-gray-500",R:"bg-blue-500",SR:"bg-purple-500",SSR:"bg-yellow-500",UR:"bg-red-500"};return t[o]||t.N},P=o=>o||"N",R=o=>{if(!o.lastInteractedAt)return!0;const t=new Date(o.lastInteractedAt),n=new Date;return t.toDateString()!==n.toDateString()},H=o=>{a.value=o,i.value=o.nickname||"",y.value=!0},M=()=>{y.value=!1,a.value=null,i.value=""},Q=()=>{a.value&&(a.value.nickname=i.value.trim()||void 0,console.log("保存昵称:",a.value.id,i.value)),M()},J=async o=>{R(o)&&(o.growthValue=Math.min(o.growthValue+10,o.maxGrowth),o.lastInteractedAt=new Date().toISOString(),await S("FEED_PET"),console.log("喂食宠物:",o.id))},K=async o=>{o.status==="BABY"&&o.growthValue>=o.maxGrowth&&(o.status="ADULT",await S("PET_EVOLVE"),console.log("宠物进化:",o.id))},W=o=>{if(o.status!=="ADULT"){alert("只有成体宠物才能分享到广场！");return}l.value=o,w.value=!0},X=async o=>{var t,n;try{const g=k.addPost({userPet:o.userPet,content:o.content,allowSale:o.allowSale,salePrice:o.salePrice,author:{id:((t=f.user)==null?void 0:t.id)||"anonymous",username:((n=f.user)==null?void 0:n.username)||"匿名用户"}});console.log("分享宠物到广场:",g),alert("分享成功！你的宠物已经展示在广场上了！")}catch(g){console.error("分享失败:",g),alert("分享失败，请重试")}},Z=()=>{w.value=!1,l.value=null},ee=o=>{console.log("赠送宠物:",o.id),window.location.href="/friends"},te=async()=>{try{const{petsApi:o}=await be(async()=>{const{petsApi:n}=await import("./pets-6Cicj7kR.js");return{petsApi:n}},__vite__mapDeps([0,1,2])),t=await o.getUserPets();v.value=t}catch(o){console.error("获取宠物收藏失败:",o),v.value=[]}};return ie(()=>{f.isAuthenticated&&te()}),(o,t)=>{var g,_;const n=ve("RouterLink");return d(),c(F,null,[e("div",Ie,[e("div",je,[t[5]||(t[5]=e("h1",{class:"mb-4",style:{"font-family":"var(--font-heading)","font-size":"var(--text-4xl)",color:"var(--color-text-primary)","font-weight":"900"}}," 🏠 我的宠物收藏 ",-1)),e("p",ze," 共 "+r(v.value.length)+" 只可爱的伙伴 ",1)]),A(f).isAuthenticated?(d(),c("div",Ge,[e("div",Fe,[e("div",Ye,[e("div",qe,[x(e("select",{"onUpdate:modelValue":t[0]||(t[0]=s=>p.value=s),class:"input"},t[6]||(t[6]=[de('<option value="">全部稀有度</option><option value="N">普通 (N)</option><option value="R">稀有 (R)</option><option value="SR">史诗 (SR)</option><option value="SSR">传说 (SSR)</option><option value="UR">神话 (UR)</option>',6)]),512),[[G,p.value]]),x(e("select",{"onUpdate:modelValue":t[1]||(t[1]=s=>m.value=s),class:"input"},t[7]||(t[7]=[e("option",{value:""},"全部状态",-1),e("option",{value:"BABY"},"幼体",-1),e("option",{value:"ADULT"},"成体",-1)]),512),[[G,m.value]])]),e("div",Oe,[x(e("input",{"onUpdate:modelValue":t[2]||(t[2]=s=>b.value=s),type:"text",placeholder:"搜索宠物名称...",class:"input w-full"},null,512),[[U,b.value]])])])]),N.value.length>0?(d(),c("div",Pe,[(d(!0),c(F,null,ue(N.value,s=>{var T,B,D,E,I,j,z;return d(),c("div",{key:s.id,class:"bg-white rounded-lg shadow-md overflow-hidden hover:shadow-lg transition-shadow"},[e("div",He,[e("img",{src:s.status==="ADULT"?(T=s.pet)==null?void 0:T.adultImageUrl:(B=s.pet)==null?void 0:B.babyImageUrl,alt:s.nickname||((D=s.pet)==null?void 0:D.name),class:"w-full h-full object-cover"},null,8,Qe),e("div",Je,[e("span",{class:V([O(((E=s.pet)==null?void 0:E.rarity)||"N"),"px-2 py-1 rounded text-xs font-bold text-white"])},r(P(((I=s.pet)==null?void 0:I.rarity)||"N")),3)]),e("div",Ke,[e("span",{class:V([s.status==="ADULT"?"bg-green-500":"bg-blue-500","px-2 py-1 rounded text-xs font-bold text-white"])},r(s.status==="ADULT"?"成体":"幼体"),3)])]),e("div",We,[e("h3",Xe,r(s.nickname||((j=s.pet)==null?void 0:j.name)),1),e("p",Ze,r((z=s.pet)==null?void 0:z.story),1),e("div",et,[e("div",tt,[t[8]||(t[8]=e("span",null,"成长进度",-1)),e("span",null,r(s.growthValue||0)+"/"+r(s.maxGrowth||100),1)]),e("div",ot,[e("div",{class:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:ge({width:(s.growthValue||0)/(s.maxGrowth||100)*100+"%"})},null,4)])]),e("div",st,[e("button",{onClick:C=>H(s),class:"flex-1 bg-blue-500 text-white py-2 px-3 rounded text-sm hover:bg-blue-600 transition-colors"},r(s.nickname?"改名":"起名"),9,lt),s.status==="BABY"&&(s.growthValue||0)>=(s.maxGrowth||100)?(d(),c("button",{key:0,onClick:C=>K(s),class:"flex-1 bg-green-500 text-white py-2 px-3 rounded text-sm hover:bg-green-600 transition-colors"}," 进化 ",8,at)):s.status==="BABY"?(d(),c("button",{key:1,onClick:C=>J(s),disabled:!R(s),class:"flex-1 bg-yellow-500 text-white py-2 px-3 rounded text-sm hover:bg-yellow-600 transition-colors disabled:bg-gray-400 disabled:cursor-not-allowed"},r(R(s)?"喂食":"已喂食"),9,nt)):$("",!0),e("button",{onClick:C=>W(s),class:"flex-1 bg-purple-500 text-white py-2 px-3 rounded text-sm hover:bg-purple-600 transition-colors"}," 分享 ",8,it),e("button",{onClick:C=>ee(s),class:"flex-1 bg-pink-500 text-white py-2 px-3 rounded text-sm hover:bg-pink-600 transition-colors"}," 赠送 ",8,rt)])])])}),128))])):(d(),c("div",dt,[t[10]||(t[10]=e("div",{class:"text-6xl mb-4"},"🎁",-1)),t[11]||(t[11]=e("h3",{class:"text-xl font-semibold mb-2"},"还没有宠物",-1)),t[12]||(t[12]=e("p",{class:"text-gray-600 mb-4"},"去商店抽取你的第一只宠物吧！",-1)),ce(n,{to:"/store",class:"bg-blue-500 text-white px-6 py-2 rounded-lg hover:bg-blue-600 transition-colors"},{default:pe(()=>t[9]||(t[9]=[me(" 前往商店 ",-1)])),_:1,__:[9]})]))])):(d(),c("div",ut,[t[13]||(t[13]=e("h2",{class:"text-2xl font-semibold mb-2"},"请先登录",-1)),t[14]||(t[14]=e("p",{class:"text-gray-600 mb-6"},"登录后查看你的宠物收藏",-1)),e("button",{onClick:t[3]||(t[3]=(...s)=>A(h).openLoginModal&&A(h).openLoginModal(...s)),class:"bg-blue-500 text-white px-6 py-2 rounded-lg hover:bg-blue-600 transition-colors"}," 登录 ")])),y.value?(d(),c("div",ct,[e("div",pt,[t[15]||(t[15]=e("h3",{class:"text-lg font-bold mb-4"},"设置宠物昵称",-1)),x(e("input",{"onUpdate:modelValue":t[4]||(t[4]=s=>i.value=s),type:"text",placeholder:(_=(g=a.value)==null?void 0:g.pet)==null?void 0:_.name,class:"w-full px-3 py-2 border rounded-lg mb-4",maxlength:"20"},null,8,vt),[[U,i.value]]),e("div",{class:"flex gap-2"},[e("button",{onClick:Q,class:"flex-1 bg-blue-500 text-white py-2 rounded hover:bg-blue-600"}," 保存 "),e("button",{onClick:M,class:"flex-1 bg-gray-500 text-white py-2 rounded hover:bg-gray-600"}," 取消 ")])])])):$("",!0)]),w.value&&l.value?(d(),re(Ee,{key:0,"user-pet":l.value,onClose:Z,onShare:X},null,8,["user-pet"])):$("",!0)],64)}}});export{xt as default};
