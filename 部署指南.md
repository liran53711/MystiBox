# ğŸš€ MystiBox éƒ¨ç½²æŒ‡å—

## ğŸ“‹ éƒ¨ç½²é€‰é¡¹

### 1. æœ¬åœ°å¼€å‘éƒ¨ç½²
é€‚åˆå¼€å‘å’Œæµ‹è¯•ç¯å¢ƒ

### 2. äº‘æœåŠ¡å™¨éƒ¨ç½²
é€‚åˆç”Ÿäº§ç¯å¢ƒï¼Œå¦‚é˜¿é‡Œäº‘ã€è…¾è®¯äº‘ã€AWSç­‰

### 3. å®¹å™¨åŒ–éƒ¨ç½²
ä½¿ç”¨Dockerè¿›è¡Œå®¹å™¨åŒ–éƒ¨ç½²

## ğŸ–¥ï¸ æœ¬åœ°å¼€å‘éƒ¨ç½²

### ç¯å¢ƒè¦æ±‚
- Node.js >= 16.0.0
- npm >= 8.0.0
- Git

### éƒ¨ç½²æ­¥éª¤
```bash
# 1. å…‹éš†é¡¹ç›®
git clone <your-repository-url>
cd MystiBox

# 2. å®‰è£…ä¾èµ–
npm install
cd backend && npm install && cd ..

# 3. é…ç½®ç¯å¢ƒå˜é‡
cd backend
cp .env.example .env
# ç¼–è¾‘ .env æ–‡ä»¶

# 4. åˆå§‹åŒ–æ•°æ®åº“
npx prisma generate
npx prisma db push

# 5. å¯åŠ¨æœåŠ¡
cd ..
npm run dev:all
```

## â˜ï¸ äº‘æœåŠ¡å™¨éƒ¨ç½²

### æœåŠ¡å™¨è¦æ±‚
- Ubuntu 20.04+ / CentOS 7+
- 2GB+ RAM
- 20GB+ å­˜å‚¨ç©ºé—´
- Node.js 16+

### 1. æœåŠ¡å™¨ç¯å¢ƒå‡†å¤‡

```bash
# æ›´æ–°ç³»ç»Ÿ
sudo apt update && sudo apt upgrade -y

# å®‰è£…Node.js
curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -
sudo apt-get install -y nodejs

# å®‰è£…PM2 (è¿›ç¨‹ç®¡ç†å™¨)
sudo npm install -g pm2

# å®‰è£…Nginx (åå‘ä»£ç†)
sudo apt install nginx -y

# å®‰è£…Git
sudo apt install git -y
```

### 2. éƒ¨ç½²åº”ç”¨

```bash
# å…‹éš†é¡¹ç›®
git clone <your-repository-url>
cd MystiBox

# å®‰è£…ä¾èµ–
npm install
cd backend && npm install && cd ..

# é…ç½®ç”Ÿäº§ç¯å¢ƒå˜é‡
cd backend
cp .env.example .env
nano .env
```

ç¼–è¾‘ `.env` æ–‡ä»¶ï¼š
```env
DATABASE_URL="file:./prod.db"
JWT_SECRET="your-production-jwt-secret-very-long-and-random"
PORT=3003
NODE_ENV="production"
FRONTEND_URL="https://your-domain.com"
```

```bash
# åˆå§‹åŒ–æ•°æ®åº“
npx prisma generate
npx prisma db push

# æ„å»ºå‰ç«¯
cd ..
npm run build

# å¯åŠ¨åç«¯æœåŠ¡
cd backend
pm2 start src/index.js --name "mystibox-backend"

# é…ç½®PM2å¼€æœºè‡ªå¯
pm2 startup
pm2 save
```

### 3. é…ç½®Nginx

åˆ›å»ºNginxé…ç½®æ–‡ä»¶ï¼š
```bash
sudo nano /etc/nginx/sites-available/mystibox
```

æ·»åŠ ä»¥ä¸‹é…ç½®ï¼š
```nginx
server {
    listen 80;
    server_name your-domain.com;

    # å‰ç«¯é™æ€æ–‡ä»¶
    location / {
        root /path/to/MystiBox/dist;
        try_files $uri $uri/ /index.html;
    }

    # APIä»£ç†
    location /api/ {
        proxy_pass http://localhost:3003;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_cache_bypass $http_upgrade;
    }
}
```

å¯ç”¨é…ç½®ï¼š
```bash
sudo ln -s /etc/nginx/sites-available/mystibox /etc/nginx/sites-enabled/
sudo nginx -t
sudo systemctl restart nginx
```

### 4. é…ç½®SSL (å¯é€‰)

```bash
# å®‰è£…Certbot
sudo apt install certbot python3-certbot-nginx -y

# è·å–SSLè¯ä¹¦
sudo certbot --nginx -d your-domain.com

# è‡ªåŠ¨ç»­æœŸ
sudo crontab -e
# æ·»åŠ : 0 12 * * * /usr/bin/certbot renew --quiet
```

## ğŸ³ Dockeréƒ¨ç½²

### 1. åˆ›å»ºDockerfile

å‰ç«¯Dockerfile (`Dockerfile.frontend`):
```dockerfile
FROM node:18-alpine

WORKDIR /app

COPY package*.json ./
RUN npm ci --only=production

COPY . .
RUN npm run build

FROM nginx:alpine
COPY --from=0 /app/dist /usr/share/nginx/html
COPY nginx.conf /etc/nginx/nginx.conf

EXPOSE 80
CMD ["nginx", "-g", "daemon off;"]
```

åç«¯Dockerfile (`backend/Dockerfile`):
```dockerfile
FROM node:18-alpine

WORKDIR /app

COPY package*.json ./
RUN npm ci --only=production

COPY . .
RUN npx prisma generate

EXPOSE 3003

CMD ["npm", "start"]
```

### 2. åˆ›å»ºdocker-compose.yml

```yaml
version: '3.8'

services:
  frontend:
    build:
      context: .
      dockerfile: Dockerfile.frontend
    ports:
      - "80:80"
    depends_on:
      - backend

  backend:
    build:
      context: ./backend
      dockerfile: Dockerfile
    ports:
      - "3003:3003"
    environment:
      - DATABASE_URL=file:./prod.db
      - JWT_SECRET=your-production-jwt-secret
      - PORT=3003
      - NODE_ENV=production
    volumes:
      - ./backend/prod.db:/app/prod.db
```

### 3. éƒ¨ç½²å‘½ä»¤

```bash
# æ„å»ºå¹¶å¯åŠ¨
docker-compose up -d

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f

# åœæ­¢æœåŠ¡
docker-compose down
```

## ğŸ”§ ç”Ÿäº§ç¯å¢ƒä¼˜åŒ–

### 1. æ€§èƒ½ä¼˜åŒ–

```bash
# å¯ç”¨Gzipå‹ç¼© (Nginx)
sudo nano /etc/nginx/nginx.conf
```

æ·»åŠ ï¼š
```nginx
gzip on;
gzip_vary on;
gzip_min_length 1024;
gzip_types text/plain text/css text/xml text/javascript application/javascript application/xml+rss application/json;
```

### 2. å®‰å…¨é…ç½®

```bash
# é…ç½®é˜²ç«å¢™
sudo ufw allow ssh
sudo ufw allow 'Nginx Full'
sudo ufw enable

# éšè—Nginxç‰ˆæœ¬
sudo nano /etc/nginx/nginx.conf
# æ·»åŠ : server_tokens off;
```

### 3. ç›‘æ§å’Œæ—¥å¿—

```bash
# PM2ç›‘æ§
pm2 monit

# æŸ¥çœ‹æ—¥å¿—
pm2 logs mystibox-backend

# è®¾ç½®æ—¥å¿—è½®è½¬
pm2 install pm2-logrotate
```

## ğŸ“Š æ•°æ®åº“å¤‡ä»½

### SQLiteå¤‡ä»½
```bash
# å¤‡ä»½æ•°æ®åº“
cp backend/prod.db backup/prod_$(date +%Y%m%d_%H%M%S).db

# è‡ªåŠ¨å¤‡ä»½è„šæœ¬
echo '#!/bin/bash
cp /path/to/MystiBox/backend/prod.db /path/to/backup/prod_$(date +%Y%m%d_%H%M%S).db
find /path/to/backup -name "prod_*.db" -mtime +7 -delete' > backup.sh

chmod +x backup.sh

# æ·»åŠ åˆ°å®šæ—¶ä»»åŠ¡
crontab -e
# æ·»åŠ : 0 2 * * * /path/to/backup.sh
```

## ğŸ”„ æ›´æ–°éƒ¨ç½²

```bash
# æ‹‰å–æœ€æ–°ä»£ç 
git pull origin main

# æ›´æ–°ä¾èµ–
npm install
cd backend && npm install && cd ..

# é‡æ–°æ„å»ºå‰ç«¯
npm run build

# é‡å¯åç«¯æœåŠ¡
cd backend
pm2 restart mystibox-backend

# é‡æ–°åŠ è½½Nginx
sudo nginx -s reload
```

## ğŸ› æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **ç«¯å£è¢«å ç”¨**
```bash
sudo lsof -i :3003
sudo kill -9 <PID>
```

2. **æƒé™é—®é¢˜**
```bash
sudo chown -R $USER:$USER /path/to/MystiBox
```

3. **æ•°æ®åº“è¿æ¥å¤±è´¥**
```bash
cd backend
npx prisma db push --force-reset
```

4. **Nginxé…ç½®é”™è¯¯**
```bash
sudo nginx -t
sudo systemctl status nginx
```

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœåœ¨éƒ¨ç½²è¿‡ç¨‹ä¸­é‡åˆ°é—®é¢˜ï¼š
1. æ£€æŸ¥æœåŠ¡å™¨æ—¥å¿—
2. ç¡®è®¤ç¯å¢ƒå˜é‡é…ç½®
3. éªŒè¯ç½‘ç»œå’Œé˜²ç«å¢™è®¾ç½®
4. æŸ¥çœ‹é¡¹ç›®æ–‡æ¡£æˆ–åˆ›å»ºIssue

---

**ç¥ä½ éƒ¨ç½²æˆåŠŸï¼** ğŸ‰
